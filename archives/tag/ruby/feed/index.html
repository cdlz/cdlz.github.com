<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Only For Sunshine~ &#187; ruby</title>
	<atom:link href="http://imzc.net/archives/tag/ruby/feed/" rel="self" type="application/rss+xml" />
	<link>http://imzc.net</link>
	<description>-More Thinking,And Then Just do it~~~</description>
	<lastBuildDate>Thu, 12 Jul 2012 16:18:11 +0000</lastBuildDate>
	<language>zh-CN</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>http://wordpress.org/?v=3.4.1</generator>
		<item>
		<title>【使用Ruby进行Web应用测试系列】二、使用watir组件登陆本博客</title>
		<link>http://imzc.net/archives/48/</link>
		<comments>http://imzc.net/archives/48/#comments</comments>
		<pubDate>Fri, 21 May 2010 12:52:00 +0000</pubDate>
		<dc:creator>imzc</dc:creator>
				<category><![CDATA[Ruby&Testing]]></category>
		<category><![CDATA[ruby]]></category>

		<guid isPermaLink="false">http://imzc.net/?action=show&#038;id=119</guid>
		<description><![CDATA[由于登录部分有验证码,为了使用方便测试,因此留了一个借口,当通过http请求该页面时,会返回验证码的数字.

比如请求http://imzc.net/get_verifycode_for_watir.php?debug=1而获得当前的验证码.

在sablog中,验证码是保存在$_SESSION中的,因此,直接显示出来即可,下面是此脚本的代码:

需要注意的是,要先请求登录页面,然后用同一个浏览器来请求此接口,否则得到的验证码不是真实的.]]></description>
			<content:encoded><![CDATA[<p>由于登录部分有验证码,为了使用方便测试,因此留了一个借口,当通过http请求该页面时,会返回验证码的数字.</p>
<p>比如请求http://imzc.net/get_verifycode_for_watir.php?debug=1而获得当前的验证码.</p>
<p>在sablog中,验证码是保存在$_SESSION中的,因此,直接显示出来即可,下面是此脚本的代码:</p>
<p>需要注意的是,要先请求登录页面,然后用同一个浏览器来请求此接口,否则得到的验证码不是真实的.</p>
<p>下面直接列出脚本,一步一步的讲解.</p>

<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre></td><td class="code"><pre class="ruby" style="font-family:monospace;"> <span style="color:#CC0066; font-weight:bold;">require</span> <span style="color:#996600;">'watir'</span>
 <span style="color:#CC0066; font-weight:bold;">require</span> <span style="color:#996600;">'logger'</span>  
&nbsp;
 <span style="color:#008000; font-style:italic;">#实例化一个日志记录类</span>
 log = <span style="color:#CC00FF; font-weight:bold;">Logger</span>.<span style="color:#9900CC;">new</span><span style="color:#006600; font-weight:bold;">&#40;</span>STDOUT<span style="color:#006600; font-weight:bold;">&#41;</span>
 <span style="color:#008000; font-style:italic;">#实例化一个IE浏览器对象</span>
 ie = <span style="color:#6666ff; font-weight:bold;">Watir::IE</span>.<span style="color:#9900CC;">new</span>
 <span style="color:#008000; font-style:italic;">#访问网站</span>
 ie.<span style="color:#9900CC;">goto</span> <span style="color:#996600;">'http://imzc.net'</span>
 <span style="color:#008000; font-style:italic;">#最大化</span>
 ie.<span style="color:#9900CC;">maximize</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#006600; font-weight:bold;">&#41;</span>
 <span style="color:#008000; font-style:italic;">#将该IE提到窗口最前面</span>
 ie.<span style="color:#9900CC;">bring_to_front</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#006600; font-weight:bold;">&#41;</span>
 <span style="color:#008000; font-style:italic;">#  找到登陆连接</span>
 ie.<span style="color:#9900CC;">link</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#ff3333; font-weight:bold;">:href</span>,<span style="color:#006600; font-weight:bold;">/</span>login<span style="color:#006600; font-weight:bold;">/</span><span style="color:#006600; font-weight:bold;">&#41;</span>.<span style="color:#9900CC;">click</span>  
&nbsp;
 <span style="color:#008000; font-style:italic;">#  找到 username,password 文本输入框</span>
 ie.<span style="color:#9900CC;">text_field</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#ff3333; font-weight:bold;">:name</span>,<span style="color:#996600;">'username'</span><span style="color:#006600; font-weight:bold;">&#41;</span>.<span style="color:#9900CC;">set</span> <span style="color:#996600;">'test'</span>
 ie.<span style="color:#9900CC;">text_field</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#ff3333; font-weight:bold;">:name</span>,<span style="color:#996600;">'password'</span><span style="color:#006600; font-weight:bold;">&#41;</span>.<span style="color:#9900CC;">set</span> <span style="color:#996600;">'testpwd'</span>  
&nbsp;
 <span style="color:#008000; font-style:italic;">#  开始取得验证码</span>
 ie2 = <span style="color:#6666ff; font-weight:bold;">Watir::IE</span>.<span style="color:#9900CC;">new</span>
 <span style="color:#008000; font-style:italic;">#  ie2.bring_to_front()</span>
 ie2.<span style="color:#9900CC;">minimize</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#006600; font-weight:bold;">&#41;</span>
 ie2.<span style="color:#9900CC;">goto</span> <span style="color:#996600;">'http://imzc.net/get_verifycode_for_watir.php?debug=1'</span>
 <span style="color:#008000; font-style:italic;">#取得返回的文本</span>
 verifycode =  ie2.<span style="color:#9900CC;">text</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#006600; font-weight:bold;">&#41;</span>
 <span style="color:#008000; font-style:italic;">#关闭此浏览器</span>
 ie2.<span style="color:#9900CC;">close</span>  
&nbsp;
 <span style="color:#008000; font-style:italic;">#  可以直接执行JavaScript代码</span>
 ie.<span style="color:#9900CC;">execute_script</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">&quot;alert('#{verifycode}');&quot;</span><span style="color:#006600; font-weight:bold;">&#41;</span>
 <span style="color:#008000; font-style:italic;">#  设置验证码</span>
 ie.<span style="color:#9900CC;">text_field</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#ff3333; font-weight:bold;">:name</span>,<span style="color:#996600;">'clientcode'</span><span style="color:#006600; font-weight:bold;">&#41;</span>.<span style="color:#9900CC;">set</span> verifycode
 <span style="color:#008000; font-style:italic;">#  由于sablog登陆表单没有表名,提交按钮不是普通的input type=&quot;submit&quot;,也没有名称,</span>
 <span style="color:#008000; font-style:italic;">#且本页面就一个method=&quot;post&quot;属性的表单,因此,使用此属性来做提交</span>
 ie.<span style="color:#9900CC;">form</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#ff3333; font-weight:bold;">:method</span>,<span style="color:#996600;">'post'</span><span style="color:#006600; font-weight:bold;">&#41;</span>.<span style="color:#9900CC;">submit</span>  
&nbsp;
 <span style="color:#008000; font-style:italic;">#先等待5秒</span>
 <span style="color:#CC0066; font-weight:bold;">sleep</span> <span style="color:#006666;">5</span>
 <span style="color:#008000; font-style:italic;"># 开始登出</span>
 <span style="color:#008000; font-style:italic;"># 加入异常处理机制</span>
 <span style="color:#9966CC; font-weight:bold;">begin</span>
   <span style="color:#008000; font-style:italic;">#是否存在这个链接,存在则不会引起异常.</span>
   <span style="color:#9966CC; font-weight:bold;">if</span> ie.<span style="color:#9900CC;">link</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#ff3333; font-weight:bold;">:href</span>,<span style="color:#006600; font-weight:bold;">/</span>logout<span style="color:#006600; font-weight:bold;">/</span><span style="color:#006600; font-weight:bold;">&#41;</span>.<span style="color:#9900CC;">exist</span>?
     <span style="color:#CC0066; font-weight:bold;">puts</span> <span style="color:#996600;">'login ok,then logout~'</span>;
     ie.<span style="color:#9900CC;">link</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#ff3333; font-weight:bold;">:href</span>,<span style="color:#006600; font-weight:bold;">/</span>logout<span style="color:#006600; font-weight:bold;">/</span><span style="color:#006600; font-weight:bold;">&#41;</span>.<span style="color:#9900CC;">click</span>
   <span style="color:#9966CC; font-weight:bold;">end</span>
 <span style="color:#9966CC; font-weight:bold;">rescue</span> =<span style="color:#006600; font-weight:bold;">&amp;</span>gt; err
   <span style="color:#CC0066; font-weight:bold;">puts</span> <span style="color:#996600;">'Error had happend in login ...'</span>;
   log.<span style="color:#9900CC;">fatal</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">&quot;Caught exception:&quot;</span><span style="color:#006600; font-weight:bold;">&#41;</span>
   log.<span style="color:#9900CC;">fatal</span><span style="color:#006600; font-weight:bold;">&#40;</span>err<span style="color:#006600; font-weight:bold;">&#41;</span>
 <span style="color:#9966CC; font-weight:bold;">end</span>
 <span style="color:#008000; font-style:italic;"># 关闭浏览器</span>
 ie.<span style="color:#9900CC;">close</span></pre></td></tr></table></div>

<p>执行此脚本时,可以看到先打开了IE浏览器,访问博客主页,进入登录页面,输入设定的用户名和密码.</p>
<p>然后再打开一个IE,请求验证码接口,最后提交,登录成功后注销,关闭浏览器.此脚本还不完善,仅仅起一个抛砖引玉的效果.</p>
<p>和大家一起学习..</p>
]]></content:encoded>
			<wfw:commentRss>http://imzc.net/archives/48/feed/</wfw:commentRss>
		<slash:comments>275</slash:comments>
		</item>
	</channel>
</rss>
