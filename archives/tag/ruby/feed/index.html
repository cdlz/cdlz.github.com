<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Only For Sunshine~ &#187; ruby</title>
	<atom:link href="http://imzc.net/archives/tag/ruby/feed/" rel="self" type="application/rss+xml" />
	<link>http://imzc.net</link>
	<description>-More Thinking,And Then Just do it~~~</description>
	<lastBuildDate>Sun, 30 Sep 2012 01:45:09 +0000</lastBuildDate>
	<language>zh-CN</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>http://wordpress.org/?v=3.4.2</generator>
		<item>
		<title>【使用Ruby进行Web应用测试系列】二、使用watir组件登陆本博客</title>
		<link>http://imzc.net/archives/48/</link>
		<comments>http://imzc.net/archives/48/#comments</comments>
		<pubDate>Fri, 21 May 2010 12:52:00 +0000</pubDate>
		<dc:creator>imzc</dc:creator>
				<category><![CDATA[Ruby&Testing]]></category>
		<category><![CDATA[ruby]]></category>

		<guid isPermaLink="false">http://imzc.net/?action=show&#038;id=119</guid>
		<description><![CDATA[由于登录部分有验证码,为了使用方便测试,因此留了一个借口,当通过http请求该页面时,会返回验证码的数字.

比如请求http://imzc.net/get_verifycode_for_watir.php?debug=1而获得当前的验证码.

在sablog中,验证码是保存在$_SESSION中的,因此,直接显示出来即可,下面是此脚本的代码:

需要注意的是,要先请求登录页面,然后用同一个浏览器来请求此接口,否则得到的验证码不是真实的.]]></description>
			<content:encoded><![CDATA[<p>由于登录部分有验证码,为了使用方便测试,因此留了一个借口,当通过http请求该页面时,会返回验证码的数字.</p>
<p>比如请求http://imzc.net/get_verifycode_for_watir.php?debug=1而获得当前的验证码.</p>
<p>在sablog中,验证码是保存在$_SESSION中的,因此,直接显示出来即可,下面是此脚本的代码:</p>
<p>需要注意的是,要先请求登录页面,然后用同一个浏览器来请求此接口,否则得到的验证码不是真实的.</p>
<p>下面直接列出脚本,一步一步的讲解.</p><pre class="crayon-plain-tag">require 'watir'
 require 'logger'  

 #实例化一个日志记录类
 log = Logger.new(STDOUT)
 #实例化一个IE浏览器对象
 ie = Watir::IE.new
 #访问网站
 ie.goto 'http://imzc.net'
 #最大化
 ie.maximize()
 #将该IE提到窗口最前面
 ie.bring_to_front()
 #  找到登陆连接
 ie.link(:href,/login/).click  

 #  找到 username,password 文本输入框
 ie.text_field(:name,'username').set 'test'
 ie.text_field(:name,'password').set 'testpwd'  

 #  开始取得验证码
 ie2 = Watir::IE.new
 #  ie2.bring_to_front()
 ie2.minimize()
 ie2.goto 'http://imzc.net/get_verifycode_for_watir.php?debug=1'
 #取得返回的文本
 verifycode =  ie2.text()
 #关闭此浏览器
 ie2.close  

 #  可以直接执行JavaScript代码
 ie.execute_script(&quot;alert('#{verifycode}');&quot;)
 #  设置验证码
 ie.text_field(:name,'clientcode').set verifycode
 #  由于sablog登陆表单没有表名,提交按钮不是普通的input type=&quot;submit&quot;,也没有名称,
 #且本页面就一个method=&quot;post&quot;属性的表单,因此,使用此属性来做提交
 ie.form(:method,'post').submit  

 #先等待5秒
 sleep 5
 # 开始登出
 # 加入异常处理机制
 begin
   #是否存在这个链接,存在则不会引起异常.
   if ie.link(:href,/logout/).exist?
     puts 'login ok,then logout~';
     ie.link(:href,/logout/).click
   end
 rescue =&amp;gt; err
   puts 'Error had happend in login ...';
   log.fatal(&quot;Caught exception:&quot;)
   log.fatal(err)
 end
 # 关闭浏览器
 ie.close</pre><p></p>
<p>执行此脚本时,可以看到先打开了IE浏览器,访问博客主页,进入登录页面,输入设定的用户名和密码.</p>
<p>然后再打开一个IE,请求验证码接口,最后提交,登录成功后注销,关闭浏览器.此脚本还不完善,仅仅起一个抛砖引玉的效果.</p>
<p>和大家一起学习..</p>
]]></content:encoded>
			<wfw:commentRss>http://imzc.net/archives/48/feed/</wfw:commentRss>
		<slash:comments>275</slash:comments>
		</item>
	</channel>
</rss>
