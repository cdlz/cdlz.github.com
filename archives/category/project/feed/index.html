<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Only For Sunshine~ &#187; Project</title>
	<atom:link href="http://imzc.net/archives/category/project/feed/" rel="self" type="application/rss+xml" />
	<link>http://imzc.net</link>
	<description>-More Thinking,And Then Just do it~~~</description>
	<lastBuildDate>Mon, 09 Jul 2012 03:09:37 +0000</lastBuildDate>
	<language>zh-CN</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>http://wordpress.org/?v=3.4.1</generator>
		<item>
		<title>worldpress插件编写-WP_OTP</title>
		<link>http://imzc.net/archives/202/</link>
		<comments>http://imzc.net/archives/202/#comments</comments>
		<pubDate>Sat, 11 Feb 2012 11:05:38 +0000</pubDate>
		<dc:creator>imzc</dc:creator>
				<category><![CDATA[IOSDev]]></category>
		<category><![CDATA[LAMP]]></category>
		<category><![CDATA[Project]]></category>

		<guid isPermaLink="false">http://imzc.net/?p=202</guid>
		<description><![CDATA[worldpress插件编写-WP_OTP,结合多个示例,理解后编写而成. 实际运行效果和介绍见:WP_OTP [...]]]></description>
			<content:encoded><![CDATA[<p>worldpress插件编写-WP_OTP,结合多个示例,理解后编写而成.<br />
实际运行效果和介绍见:<a href="http://imzc.net/wp_otp" target="_blank">WP_OTP</a></p>

<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
</pre></td><td class="code"><pre class="php" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">&lt;?php</span>
 <span style="color: #666666; font-style: italic;">/*
 Plugin Name: OATH_OTP
 Plugin URI: http://imzc.net/wp_otp
 Version: 0.0.1
 Author: Richard Chou
 Description: OATH_OTP
 */</span>
&nbsp;
<span style="color: #666666; font-style: italic;">// error_reporting(E_ALL);</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">global</span> <span style="color: #000088;">$shakehand_key</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">//20bit</span>
<span style="color: #000088;">$shakehand_key</span> <span style="color: #339933;">=</span> get_option<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;shakehand_key&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #666666; font-style: italic;">//translate language, not completed.</span>
<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><span style="color: #990000;">function_exists</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'tr'</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
	<span style="color: #000000; font-weight: bold;">function</span> tr<span style="color: #009900;">&#40;</span><span style="color: #000088;">$str</span> <span style="color: #339933;">,</span><span style="color: #000088;">$section</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
		<span style="color: #b1b100;">return</span> <span style="color: #000088;">$str</span> <span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
&nbsp;
<span style="color: #000000; font-weight: bold;">function</span> auth_check<span style="color: #009900;">&#40;</span><span style="color: #000088;">$clientSideSha1Str</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
	<span style="color: #000000; font-weight: bold;">global</span> <span style="color: #000088;">$shakehand_key</span><span style="color: #339933;">;</span>
	<span style="color: #666666; font-style: italic;">//die($shakehand_key);</span>
	<span style="color: #000088;">$seed</span> <span style="color: #339933;">=</span> <span style="color: #990000;">time</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #000088;">$seed</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$seed</span> <span style="color: #339933;">-</span> <span style="color: #000088;">$seed</span><span style="color: #339933;">%</span><span style="color:#800080;">30</span> <span style="color: #339933;">;</span>
	<span style="color: #666666; font-style: italic;">//$clientSideSha1Str = sha1($code.$shakehand_key);</span>
	<span style="color: #000088;">$webSideSha1Str</span> <span style="color: #339933;">=</span><span style="color: #990000;">sha1</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$seed</span><span style="color: #339933;">.</span><span style="color: #000088;">$shakehand_key</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #666666; font-style: italic;">//echo &quot;====seed:$seed=====&quot;.$webSideSha1Str.&quot;,&quot;.$clientSideSha1Str.&quot;===&quot;;</span>
&nbsp;
	<span style="color: #000088;">$clientSideCode</span> <span style="color: #339933;">=</span> <span style="color: #990000;">substr</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$clientSideSha1Str</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">6</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #000088;">$webSideCode</span> <span style="color: #339933;">=</span> <span style="color: #990000;">substr</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$webSideSha1Str</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">6</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$clientSideCode</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$webSideCode</span> <span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
		<span style="color: #b1b100;">return</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span><span style="color: #b1b100;">else</span><span style="color: #009900;">&#123;</span>
		<span style="color: #b1b100;">return</span> <span style="color: #009900; font-weight: bold;">false</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span>
<span style="color: #666666; font-style: italic;">// this function adds captcha to the login form</span>
<span style="color: #000000; font-weight: bold;">function</span> oath_login_form<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span> <span style="color: #990000;">session_id</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">==</span> <span style="color: #0000ff;">&quot;&quot;</span> <span style="color: #009900;">&#41;</span>
		<span style="color: #990000;">session_start</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #000000; font-weight: bold;">global</span> <span style="color: #000088;">$cptch_options</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #666666; font-style: italic;">// captcha html - login form</span>
	<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">'&lt;p class=&quot;cptch_block&quot;&gt;'</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span> <span style="color: #0000ff;">&quot;&quot;</span> <span style="color: #339933;">!=</span> <span style="color: #000088;">$cptch_options</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'cptch_label_form'</span><span style="color: #009900;">&#93;</span> <span style="color: #009900;">&#41;</span>	
		<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">'&lt;label&gt;'</span><span style="color: #339933;">.</span> <span style="color: #990000;">stripslashes</span><span style="color: #009900;">&#40;</span> <span style="color: #000088;">$cptch_options</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'cptch_label_form'</span><span style="color: #009900;">&#93;</span> <span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span><span style="color: #0000ff;">'&lt;/label&gt;&lt;br /&gt;'</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span> <span style="color: #990000;">isset</span><span style="color: #009900;">&#40;</span> <span style="color: #000088;">$_SESSION</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'cptch_error'</span><span style="color: #009900;">&#93;</span> <span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">&quot;&lt;br /&gt;&lt;span style='color:red'&gt;&quot;</span><span style="color: #339933;">.</span> <span style="color: #000088;">$_SESSION</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'cptch_error'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">.</span><span style="color: #0000ff;">&quot;&lt;/span&gt;&lt;br /&gt;&quot;</span><span style="color: #339933;">;</span>
		<span style="color: #990000;">unset</span><span style="color: #009900;">&#40;</span> <span style="color: #000088;">$_SESSION</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'cptch_error'</span><span style="color: #009900;">&#93;</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
	<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">'&lt;br /&gt;'</span><span style="color: #339933;">;</span>
	oath_display_captcha<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">'&lt;/p&gt;
	&lt;br /&gt;'</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #b1b100;">return</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #009900;">&#125;</span> <span style="color: #666666; font-style: italic;">//  end function oath_login_form</span>
&nbsp;
<span style="color: #666666; font-style: italic;">// this function checks captcha posted with a login</span>
<span style="color: #000000; font-weight: bold;">function</span> oath_login_post<span style="color: #009900;">&#40;</span><span style="color: #000088;">$errors</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #000000; font-weight: bold;">global</span> <span style="color: #000088;">$str_key</span><span style="color: #339933;">;</span>
	<span style="color: #000088;">$str_key</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;123&quot;</span><span style="color: #339933;">;</span>
	<span style="color: #666666; font-style: italic;">// Delete errors, if they set</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span> <span style="color: #990000;">isset</span><span style="color: #009900;">&#40;</span> <span style="color: #000088;">$_SESSION</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'cptch_error'</span><span style="color: #009900;">&#93;</span> <span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#41;</span>
		<span style="color: #990000;">unset</span><span style="color: #009900;">&#40;</span> <span style="color: #000088;">$_SESSION</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'cptch_error'</span><span style="color: #009900;">&#93;</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span> <span style="color: #990000;">isset</span><span style="color: #009900;">&#40;</span> <span style="color: #000088;">$_REQUEST</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'action'</span><span style="color: #009900;">&#93;</span> <span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #0000ff;">'register'</span> <span style="color: #339933;">==</span> <span style="color: #000088;">$_REQUEST</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'action'</span><span style="color: #009900;">&#93;</span> <span style="color: #009900;">&#41;</span>
		<span style="color: #b1b100;">return</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$errors</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #666666; font-style: italic;">// If captcha not complete, return error</span>
	<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span> <span style="color: #990000;">isset</span><span style="color: #009900;">&#40;</span> <span style="color: #000088;">$_REQUEST</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'cptch_number'</span><span style="color: #009900;">&#93;</span> <span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #0000ff;">&quot;&quot;</span> <span style="color: #339933;">==</span>  <span style="color: #000088;">$_REQUEST</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'cptch_number'</span><span style="color: #009900;">&#93;</span> <span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>	
		<span style="color: #b1b100;">return</span> <span style="color: #000088;">$errors</span><span style="color: #339933;">.</span><span style="color: #0000ff;">'&lt;strong&gt;'</span><span style="color: #339933;">.</span> tr<span style="color: #009900;">&#40;</span> <span style="color: #0000ff;">'ERROR'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'captcha'</span> <span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span><span style="color: #0000ff;">'&lt;/strong&gt;: '</span><span style="color: #339933;">.</span> tr<span style="color: #009900;">&#40;</span> <span style="color: #0000ff;">'Please complete the CAPTCHA.'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'captcha'</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span>auth_check<span style="color: #009900;">&#40;</span><span style="color: #990000;">trim</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$_REQUEST</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'cptch_number'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">===</span><span style="color: #009900; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
		<span style="color: #666666; font-style: italic;">// captcha was matched						</span>
	<span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #b1b100;">return</span> <span style="color: #000088;">$errors</span><span style="color: #339933;">.</span><span style="color: #0000ff;">'&lt;strong&gt;'</span><span style="color: #339933;">.</span> tr<span style="color: #009900;">&#40;</span> <span style="color: #0000ff;">'ERROR'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'captcha'</span> <span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span><span style="color: #0000ff;">'&lt;/strong&gt;: '</span><span style="color: #339933;">.</span> tr<span style="color: #009900;">&#40;</span> <span style="color: #0000ff;">'That CAPTCHA was incorrect.'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'captcha'</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
  <span style="color: #b1b100;">return</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$errors</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span> <span style="color: #666666; font-style: italic;">// end function oath_login_post</span>
&nbsp;
<span style="color: #666666; font-style: italic;">// this function checks the captcha posted with a login when login errors are absent</span>
<span style="color: #000000; font-weight: bold;">function</span> oath_login_check<span style="color: #009900;">&#40;</span><span style="color: #000088;">$url</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #000000; font-weight: bold;">global</span> <span style="color: #000088;">$str_key</span><span style="color: #339933;">;</span>
	<span style="color: #000000; font-weight: bold;">global</span> <span style="color: #000088;">$auth_tmp_key</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span> <span style="color: #990000;">session_id</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">==</span> <span style="color: #0000ff;">&quot;&quot;</span> <span style="color: #009900;">&#41;</span>
		<span style="color: #990000;">session_start</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #000088;">$str_key</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;123&quot;</span><span style="color: #339933;">;</span>
	<span style="color: #666666; font-style: italic;">// Add error if captcha is empty</span>
	<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span> <span style="color: #990000;">isset</span><span style="color: #009900;">&#40;</span> <span style="color: #000088;">$_REQUEST</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'cptch_number'</span><span style="color: #009900;">&#93;</span> <span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #0000ff;">&quot;&quot;</span> <span style="color: #339933;">==</span>  <span style="color: #000088;">$_REQUEST</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'cptch_number'</span><span style="color: #009900;">&#93;</span> <span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000088;">$_SESSION</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'cptch_error'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> tr<span style="color: #009900;">&#40;</span> <span style="color: #0000ff;">'Please complete the CAPTCHA.'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'captcha'</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #666666; font-style: italic;">// Redirect to wp-login.php</span>
		<span style="color: #b1b100;">return</span> <span style="color: #000088;">$_SERVER</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">&quot;REQUEST_URI&quot;</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
	<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span> <span style="color: #990000;">isset</span><span style="color: #009900;">&#40;</span> <span style="color: #000088;">$_REQUEST</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'cptch_result'</span><span style="color: #009900;">&#93;</span> <span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #990000;">isset</span><span style="color: #009900;">&#40;</span> <span style="color: #000088;">$_REQUEST</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'cptch_number'</span><span style="color: #009900;">&#93;</span> <span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span>auth_check<span style="color: #009900;">&#40;</span><span style="color: #990000;">trim</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$_REQUEST</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'cptch_number'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">===</span><span style="color: #009900; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
			<span style="color: #b1b100;">return</span> <span style="color: #000088;">$url</span><span style="color: #339933;">;</span>		<span style="color: #666666; font-style: italic;">// captcha was matched						</span>
		<span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #666666; font-style: italic;">// Add error if captcha is incorrect</span>
			<span style="color: #000088;">$_SESSION</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'cptch_error'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> tr<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'That CAPTCHA was incorrect.'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'captcha'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #666666; font-style: italic;">// Redirect to wp-login.php</span>
			<span style="color: #b1b100;">return</span> <span style="color: #000088;">$_SERVER</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">&quot;REQUEST_URI&quot;</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
	<span style="color: #009900;">&#125;</span>
	<span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #b1b100;">return</span> <span style="color: #000088;">$url</span><span style="color: #339933;">;</span>		<span style="color: #666666; font-style: italic;">// captcha was matched						</span>
	<span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span> <span style="color: #666666; font-style: italic;">// end function oath_login_post</span>
&nbsp;
&nbsp;
&nbsp;
<span style="color: #666666; font-style: italic;">// Functionality of the captcha logic work</span>
<span style="color: #000000; font-weight: bold;">function</span> oath_display_captcha<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
<span style="color: #009900;">&#123;</span>
	<span style="color: #000000; font-weight: bold;">global</span> <span style="color: #000088;">$cptch_options</span><span style="color: #339933;">,</span><span style="color: #000088;">$auth_tmp_key</span> <span style="color: #339933;">;</span>
    <span style="color: #000000; font-weight: bold;">global</span> <span style="color: #000088;">$shakehand_key</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #666666; font-style: italic;">// String for display </span>
	<span style="color: #000088;">$seed</span> <span style="color: #339933;">=</span> <span style="color: #990000;">time</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">?&gt;</span>
    OATH_OTP(<span style="color: #000000; font-weight: bold;">&lt;?php</span> <span style="color: #b1b100;">echo</span> <span style="color: #990000;">substr</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;<span style="color: #006699; font-weight: bold;">$seed</span>&quot;</span><span style="color: #339933;">,-</span><span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">3</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><span style="color: #000000; font-weight: bold;">?&gt;</span>):&lt;input type=&quot;text&quot; name=&quot;cptch_number&quot; tabindex=&quot;30&quot; value=&quot;&quot; maxlength=&quot;10&quot; size=&quot;1&quot; style=&quot;width:100px;margin-bottom:0;display:inline;&quot; /&gt;&lt;br /&gt;
	&lt;input type=&quot;hidden&quot; name=&quot;cptch_result&quot; value=&quot; <span style="color: #000000; font-weight: bold;">&lt;?php</span> <span style="color: #b1b100;">echo</span> <span style="color: #000088;">$auth_tmp_key</span><span style="color: #339933;">;</span> <span style="color: #000000; font-weight: bold;">?&gt;</span>&quot; /&gt;&lt;input type=&quot;hidden&quot; value=&quot;Version: 0.0.1&quot; /&gt;
&nbsp;
<span style="color: #000000; font-weight: bold;">&lt;?php</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
&nbsp;
	add_action<span style="color: #009900;">&#40;</span> <span style="color: #0000ff;">'login_form'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'oath_login_form'</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	add_filter<span style="color: #009900;">&#40;</span> <span style="color: #0000ff;">'login_errors'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'oath_login_post'</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	add_filter<span style="color: #009900;">&#40;</span> <span style="color: #0000ff;">'login_redirect'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'oath_login_check'</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">10</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">3</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> 
&nbsp;
&nbsp;
&nbsp;
<span style="color: #666666; font-style: italic;">// Function for display oather settings page in the admin area</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">function</span> oather_activate<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    add_option<span style="color: #009900;">&#40;</span> <span style="color: #0000ff;">'shakehand_key'</span><span style="color: #339933;">,</span>  <span style="color: #0000ff;">&quot;testcoco&quot;</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #666666; font-style: italic;">//这里也可以用update_option，区别是使用update_action会在每一次重新启用插件时重置用户设置为默认值。</span>
&nbsp;
<span style="color: #009900;">&#125;</span>
register_activation_hook<span style="color: #009900;">&#40;</span><span style="color: #009900; font-weight: bold;">__FILE__</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'oather_activate'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
&nbsp;
<span style="color: #000000; font-weight: bold;">function</span> oather_admin_init<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
    <span style="color: #666666; font-style: italic;">//注册配置，第3个参数是回调函数，用于过滤提交的内容</span>
	<span style="color: #666666; font-style: italic;">//register_setting( $option_group, $option_name, $sanitize_callback )</span>
    register_setting<span style="color: #009900;">&#40;</span> <span style="color: #0000ff;">'shakehand_key'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'oather_options'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'oather_options_validate'</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	 <span style="color: #666666; font-style: italic;">//添加设置群</span>
	 <span style="color: #666666; font-style: italic;">//add_settings_section( $id, $title, $callback, $page ); </span>
    add_settings_section<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'oather_main'</span><span style="color: #339933;">,</span> tr<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'Settings'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'oath'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'oather_section'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'oather'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
   <span style="color: #666666; font-style: italic;">//添加具体配置</span>
    <span style="color: #666666; font-style: italic;">//add_settings_field( $id,                  $title,                               $callback,    $page,      $section,   $args );</span>
    add_settings_field<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'oather_shakehand_key'</span><span style="color: #339933;">,</span> tr<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'oather_shakehand_key'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'oath'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'oather_authkey'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'oather'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'oather_main'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> 
&nbsp;
&nbsp;
<span style="color: #009900;">&#125;</span>
add_action<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'admin_init'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'oather_admin_init'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
&nbsp;
&nbsp;
<span style="color: #000000; font-weight: bold;">function</span> oather_authkey<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
<span style="color: #009900;">&#123;</span>
    <span style="color: #000088;">$shakehand_key</span> <span style="color: #339933;">=</span> get_option<span style="color: #009900;">&#40;</span> <span style="color: #0000ff;">'shakehand_key'</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> 
<span style="color: #666666; font-style: italic;">//	echo &quot;&lt;br&gt; $shakehand_key:&quot;;print_r($shakehand_key);</span>
<span style="color: #000000; font-weight: bold;">?&gt;</span>&lt;input id=&quot;oather_shakehand_key&quot; name=&quot;oather_shakehand_key&quot; style=&quot;width:200px;&quot; maxlength=&quot;20&quot;  value=&quot;<span style="color: #000000; font-weight: bold;">&lt;?php</span> <span style="color: #b1b100;">echo</span> <span style="color: #000088;">$shakehand_key</span><span style="color: #339933;">;</span><span style="color: #000000; font-weight: bold;">?&gt;</span>&quot; /&gt;(6-20 chars)&lt;br /&gt;
<span style="color: #000000; font-weight: bold;">&lt;?php</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
&nbsp;
&nbsp;
<span style="color: #000000; font-weight: bold;">function</span> oather_section<span style="color: #009900;">&#40;</span><span style="color: #000088;">$section</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
	<span style="color: #b1b100;">return</span> <span style="color: #000088;">$section</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span>
<span style="color: #000000; font-weight: bold;">function</span> oather_options_validate<span style="color: #009900;">&#40;</span><span style="color: #000088;">$input</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> 
    <span style="color: #b1b100;">return</span> <span style="color: #000088;">$input</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">function</span> oather_options_page<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
<span style="color: #000000; font-weight: bold;">?&gt;</span>
    &lt;div class=&quot;wrap&quot;&gt;
        &lt;h2&gt;<span style="color: #000000; font-weight: bold;">&lt;?php</span> <span style="color: #b1b100;">echo</span> tr<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'OATH_OTP'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'oath'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #000000; font-weight: bold;">?&gt;</span>&lt;/h2&gt;
        &lt;div class=&quot;narrow&quot;&gt;
            &lt;form action=&quot;options.php&quot; method=&quot;post&quot;&gt;
                &lt;p&gt;<span style="color: #000000; font-weight: bold;">&lt;?php</span> <span style="color: #b1b100;">echo</span> tr<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'OATH_OTP目前仅有ios配对客户端,使用时间戳和shakehandKey结合认证.'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'oath'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #000000; font-weight: bold;">?&gt;</span>&lt;/p&gt;
                <span style="color: #000000; font-weight: bold;">&lt;?php</span> settings_fields<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'shakehand_key'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #000000; font-weight: bold;">?&gt;</span>
                <span style="color: #000000; font-weight: bold;">&lt;?php</span> do_settings_sections<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'oather'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #000000; font-weight: bold;">?&gt;</span>
                &lt;p class=&quot;submit&quot;&gt;
                    &lt;input name=&quot;submit&quot; type=&quot;submit&quot; class=&quot;button-primary&quot; value=&quot;<span style="color: #000000; font-weight: bold;">&lt;?php</span> <span style="color: #b1b100;">echo</span> tr<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'Save Changes'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'oath'</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">?&gt;</span>&quot; /&gt;
                &lt;/p&gt;
            &lt;/form&gt;
        &lt;/div&gt;
    &lt;/div&gt;
<span style="color: #000000; font-weight: bold;">&lt;?php</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
 <span style="color: #666666; font-style: italic;">//在设置页添加链接</span>
<span style="color: #000000; font-weight: bold;">function</span> oather_menu<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    add_options_page<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'OATH_OTP Settings'</span><span style="color: #339933;">,</span>  tr<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'OATH_OTP'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'oath'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'manage_options'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'oath_otp'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'oather_options_page'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">function</span> oather_action_links<span style="color: #009900;">&#40;</span> <span style="color: #000088;">$links</span><span style="color: #339933;">,</span> <span style="color: #000088;">$file</span> <span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span> <span style="color: #000088;">$file</span> <span style="color: #339933;">!=</span> plugin_basename<span style="color: #009900;">&#40;</span> <span style="color: #009900; font-weight: bold;">__FILE__</span> <span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
        <span style="color: #b1b100;">return</span> <span style="color: #000088;">$links</span><span style="color: #339933;">;</span>
    <span style="color: #000088;">$settings_link</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">'&lt;a href=&quot;options-general.php?page=oath_otp&quot;&gt;Settings&lt;/a&gt;'</span><span style="color: #339933;">;</span>
    <span style="color: #990000;">array_unshift</span><span style="color: #009900;">&#40;</span> <span style="color: #000088;">$links</span><span style="color: #339933;">,</span> <span style="color: #000088;">$settings_link</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #b1b100;">return</span> <span style="color: #000088;">$links</span><span style="color: #339933;">;</span>
    <span style="color: #666666; font-style: italic;">//在插件页添加链接</span>
<span style="color: #009900;">&#125;</span>
add_filter<span style="color: #009900;">&#40;</span> <span style="color: #0000ff;">'plugin_action_links'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'oather_action_links'</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">10</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
add_action<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'admin_menu'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'oather_menu'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
&nbsp;
&nbsp;
<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #990000;">isset</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$_POST</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'oather_shakehand_key'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
	<span style="color: #666666; font-style: italic;">//update post</span>
	<span style="color: #000088;">$shakehand_len</span> <span style="color: #339933;">=</span> <span style="color: #990000;">strlen</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$_POST</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'oather_shakehand_key'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$shakehand_len</span> <span style="color: #339933;">&gt;=</span><span style="color: #cc66cc;">6</span>  <span style="color: #339933;">&amp;&amp;</span> <span style="color: #000088;">$shakehand_len</span> <span style="color: #339933;">&lt;=</span><span style="color: #cc66cc;">20</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span> 
		 	 update_option<span style="color: #009900;">&#40;</span> <span style="color: #0000ff;">'shakehand_key'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$_POST</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'oather_shakehand_key'</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">,</span><span style="color: #0000ff;">''</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'yes'</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> 
               <span style="color: #666666; font-style: italic;">//  print_r($_POST);   </span>
			 <span style="color: #000088;">$message</span> <span style="color: #339933;">=</span> __<span style="color: #009900;">&#40;</span> <span style="color: #0000ff;">&quot;Options saved.&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'oath'</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span><span style="color: #b1b100;">else</span><span style="color: #009900;">&#123;</span>
			 <span style="color: #000088;">$message</span> <span style="color: #339933;">=</span> tr<span style="color: #009900;">&#40;</span> <span style="color: #0000ff;">&quot;Options save failed,shakehand_key must be in 6 to 20 chars.&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">'oath'</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		 <span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
&nbsp;
&nbsp;
 <span style="color: #000000; font-weight: bold;">?&gt;</span></pre></td></tr></table></div>

<p>&nbsp;</p>
]]></content:encoded>
			<wfw:commentRss>http://imzc.net/archives/202/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>宽带拨号助手V1.3 for CQUPT with winXP</title>
		<link>http://imzc.net/archives/51/</link>
		<comments>http://imzc.net/archives/51/#comments</comments>
		<pubDate>Sun, 15 Nov 2009 00:56:00 +0000</pubDate>
		<dc:creator>imzc</dc:creator>
				<category><![CDATA[Project]]></category>
		<category><![CDATA[dailhelper]]></category>

		<guid isPermaLink="false">http://imzc.net/?action=show&#038;id=115</guid>
		<description><![CDATA[带拨号助手V1.3(重邮校园网+windowsXP通过) richardhc@2009.11.15. 增加:  [...]]]></description>
			<content:encoded><![CDATA[<p><strong>带拨号助手</strong><strong>V1.3(重邮校园网+windowsXP通过)<br />
</strong>richardhc@2009.11.15.</p>
<p>增加:</p>
<p>点击最小化可以到系统托盘区(可以实现断线自动重拨).</p>
<p>双击托盘图标可以恢复显示</p>
<p>右键单击托盘图标有弹出菜单.</p>
<p>[恢复窗口]:同双击一样</p>
<p>重邮Online:快捷方式打开Online主页</p>
<p>[断开计费]:断开外网连接并关闭程序</p>
<p>[关闭程序]:仅关闭程序,同主界面的x按钮</p>
<p>PS:</p>
<p>程序源码也一起放出,请在下方下载:</p>
<p><a href="http://download.csdn.net/user/richardhochou/uploads">http://download.csdn.net/detail/richardhochou/3658314</a></p>
<p><a href="http://imzc.net/wp-content/uploads/2009/11/dail.jpg"><img class="size-medium wp-image-92 alignleft" title="dail" src="http://imzc.net/wp-content/uploads/2009/11/dail-238x300.jpg" alt="" width="238" height="300" /></a></p>
]]></content:encoded>
			<wfw:commentRss>http://imzc.net/archives/51/feed/</wfw:commentRss>
		<slash:comments>1</slash:comments>
		</item>
		<item>
		<title>Netkeeper For Linux(含源码)</title>
		<link>http://imzc.net/archives/52/</link>
		<comments>http://imzc.net/archives/52/#comments</comments>
		<pubDate>Wed, 16 Sep 2009 20:37:00 +0000</pubDate>
		<dc:creator>imzc</dc:creator>
				<category><![CDATA[Project]]></category>
		<category><![CDATA[Netkeeper]]></category>

		<guid isPermaLink="false">http://imzc.net/?action=show&#038;id=108</guid>
		<description><![CDATA[Netkeeper For Linux =================================== [...]]]></description>
			<content:encoded><![CDATA[<p>Netkeeper For Linux<br />
=========================================================<br />
+ Netkeeper Linux Login for Ubuntu9.04                                                                              +<br />
+    Generate by zc@imzc.net,http://imzc.net                                                                            +<br />
+    Thanks to yangchen(181158257),韵之飘(59077227).                                                        +<br />
+    重邮Online: http://hongyan.cqupt.edu.cn/cqupt/                                                                 +<br />
=========================================================<br />
Linux 下的 星空拨号支持<br />
基本思路:<br />
1.用xsupplicant实现802内网认证器.<br />
2.用生成动态用户名的配置文件 再调用pppoe拨号,实现外网认证.<br />
系统要求:<br />
安装有ras-pppoe,ubuntu9.04已预装,无需再装.<br />
Ubuntu8.10,ubuntu9.04测试通过.<br />
注意<br />
本程序只能运行在root用户下<br />
Ubuntu请用sudo -s -H命令切换到root用户.</p>
<p>说明:<br />
1.将下载的压缩包解压到任意位置，该目录我称为“$Netkeeper”;<br />
2.修改[$Netkeeper/install/xsupplicant.conf]文件,填写自己的内网帐号和密码.<br />
用户替换:012xxx 117,140,247行三处,密码替换:123xxx 141行<br />
3.运行[$Netkeeper/install/install_802_netkeeper]安装好802内网认证和外网认证.如果提 示&#8221;Command not found&#8221;,则需要给予执行权限.sudo chmod a+x install_802_netkeeper<br />
注意:在安装外网认证时会调用pppoeconf对PPPoE进行设置，此时必需按照流程成功设置才可以.<br />
4.修改程序目录里的Netkeeper.pppoe文件,将此文件里的user和password行删除(如果有的话)<br />
将网关IP添加到[$Netkeeper/dial]文件第9行对应位置.<br />
5.sudo ./dial<br />
6.运行sudo .hangup断开连接<br />
原理:调用poff挂断</p>
<p>tips:<br />
1.Linux下用pppoe拨号网卡设置必须设成DHCP自动获取模式，否则拨上号却无法ping通任何地址，可能是DNS的问题<br />
2.plog用于查询拨号记录<br />
3.手动添加内网路由表: 先将自己的网关添加到[$Netkeeper/ip_route]脚本gateway=后面,保存,然后运行即可.<br />
4.bug反映请Email我,zc@imzc.net.程序说明文件有我的QQ号.不解答能在google一搜就有的问题哈,谢谢! 重邮的请加Linux协会群,10841348,找richardhc即可.外校的朋友请注明一下.</p>
<p><strong><span style="color: #339966; font-size: medium;">PS:现在由于加的人多了点,联系我的话就邮件联系吧.一概不加Q老&#8230;希望理解.</span></strong><br />
5.请支持由红岩网校基于UCHOME开发的属于我们的社区<br />
重邮Online: http://hongyan.cqupt.edu.cn/cqupt/</p>
<hr size="2" /><span style="color: #0080ff;">HELP:</span></p>
<p><span style="color: #0080ff;">在不能上网的时候,可以看看按照下列步骤试试.<br />
</span></p>
<p><span style="color: #0080ff;">1.你的系统是不是ubuntu的.<br />
2.将dial文件中第19行dhclient #eth0改为dhclient eth0 试试(网卡若为eth1则为eth1).<br />
3.先上内网试试,看能不能使用.<br />
4.若确认你的账号和密码正确了的,且在windows下账号能上外网.<br />
5.删除/etc/ppp/peers/dsl-provider文件,重新install一次.按照说明文档的步骤来</span></p>
<hr size="2" />更新:<br />
不同地区的RADIUS可能会不同,需要自行在Netkeeper运行程序中查找,用一般的16进制编辑器就可以了(我用的是WinHex).可以不用OD.<br />
找到后,改动文件CXKUsername.cpp的12行RADIUS(&#8220;chongqingradius1&#8243;)中chongqingradius1<br />
部分.然后make即可.如果获取的MD5字符串错误,请检查编译环境.<br />
然后替换原来的程序即可.不用802.1认证内网的,就不用那个步骤了.﻿</p>
<p>源码:diallinux_v1.0_src_a.tar.gz<br />
程序:<br />
带802.1的:diallinux_bin_v1.0_20090916.tar.gz<br />
不带802.1的:netkeeper_no_802.1.zip</p>
<p>netkeeper_ubuntu_脚本20091205更新:<br />
./dial 内外网;<br />
./dail 802 仅内网;<br />
./dial net仅外网 ;<br />
./dial logout 挂断内外网;<br />
添加了DNS修改（加上了重邮教育网主DNS和电信次要DNS）<br />
下载：netkeeper_ubuntu_脚本20091205更新.tar.gz 替换原有文件即可。</p>
<p>本文提到的所有文件见csdn下载附件: <a href="http://u252.com/tq25n" title="http://u252.com/tq25n">http://u252.com/tq25n</a></p>
]]></content:encoded>
			<wfw:commentRss>http://imzc.net/archives/52/feed/</wfw:commentRss>
		<slash:comments>2</slash:comments>
		</item>
	</channel>
</rss>
