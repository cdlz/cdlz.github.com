<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Only For Sunshine~</title>
	<atom:link href="http://imzc.net/feed/" rel="self" type="application/rss+xml" />
	<link>http://imzc.net</link>
	<description>-More Thinking,And Then Just do it~~~</description>
	<lastBuildDate>Mon, 09 Jul 2012 03:09:37 +0000</lastBuildDate>
	<language>zh-CN</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>http://wordpress.org/?v=3.4.1</generator>
		<item>
		<title>linux下STAF执行失败时的处理</title>
		<link>http://imzc.net/archives/268/</link>
		<comments>http://imzc.net/archives/268/#comments</comments>
		<pubDate>Mon, 09 Jul 2012 03:09:37 +0000</pubDate>
		<dc:creator>imzc</dc:creator>
				<category><![CDATA[Ruby&Testing]]></category>

		<guid isPermaLink="false">http://imzc.net/?p=268</guid>
		<description><![CDATA[最近使用staf时,老是提示xxx.so找不到,按照网上的解决方案设置了,都不行,结果发现问题出现在命令上面: [...]]]></description>
			<content:encoded><![CDATA[<p>最近使用staf时,老是提示xxx.so找不到,按照网上的解决方案设置了,都不行,结果发现问题出现在命令上面:</p>
<p>使用screen防止ssh突然断链,而screen和普通直接登录ssh时不一样.执行命令时,我直接使用了:screen xxx,</p>
<p>猜想:screen command时,在未执行 /etc/profile.从而导致使用xshell登录ssh的环境变量和command通过screen运行时的环境变量不一致.</p>
<p>修复错误: screen -t &#8220;windows name&#8221;后,先执行一下/etc/profile,然后再执行自己的命令.</p>
<p>&nbsp;</p>
<blockquote><p>附上找不到libSTAF.so时,<a href="http://katrina-lxd.i.sohu.com/blog/view/184589263.htm" target="_blank">网上的</a>一般解决方案:</p>
<p>1、启动时：error while loading shared libraries: libSTAF.so: cannot open shared object file: No such file or directory</p>
<p>&nbsp;</p>
<p>解决思路：</p>
<p>（1）、staf默认安装在/usr/local/staf下，如果当前用户不是root用户，确认登录用户有操作该文件夹的权限。</p>
<p>（2）、LD_LIBRARY_PATH未配置staf的库</p>
<p>export LD_LIBRARY_PATH=/usr/local/staf/lib</p>
<p>（3）、LD_LIBRARY_PATH配置成功后运行STAFProc有如下提示：</p>
<p>STAF bin directory not found in PATH, STAF RC: 48, OS RC: 0</p>
<p>配置PATH：PATH=/usr/local/staf/bin:$PATH<br />
export PATH</p>
<p>&nbsp;</p>
<p>2、linux下安装staf之前，</p>
<p>cd /usr/lib</p>
<p>ll libstdc*</p>
<p>如果有C库，不用安装了。</p>
<p>&nbsp;</p>
<p>3、若安装stax，需先安装jvm或者带jvm的staf</p>
<p>&nbsp;</p>
<p>4、配置好stax启动staf时，</p>
<p>Error constructing service, JSTAF, Result: Unable to connect to JVM</p>
<p>并且/usr/local/staf/data/STAF/lang/java/jvm/STAFJVM1中的日志为</p>
<p>Caused by: java.lang.ClassNotFoundException: com.ibm.staf.service.STAFServiceHelper</p>
<p>解决：</p>
<p>（1）确认的位置JSTAF.jar：windows默认在C:\STAF\bin\JSTAF.jar，linux默认在/usr/local/staf/lib/JSTAF.jar。<tt></tt></p>
<p>（2）将JSTAF.jar添加到CLASSPATH中。</p></blockquote>
]]></content:encoded>
			<wfw:commentRss>http://imzc.net/archives/268/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>ruby Rspec测试框架cheetsheet</title>
		<link>http://imzc.net/archives/267/</link>
		<comments>http://imzc.net/archives/267/#comments</comments>
		<pubDate>Wed, 04 Jul 2012 16:57:39 +0000</pubDate>
		<dc:creator>imzc</dc:creator>
				<category><![CDATA[Ruby&Testing]]></category>

		<guid isPermaLink="false">http://imzc.net/?p=267</guid>
		<description><![CDATA[项目使用Rspec测试框架,一堆should等等方法容易忘记,这里收集了下: INSTALL =======  [...]]]></description>
			<content:encoded><![CDATA[<p>项目使用Rspec测试框架,一堆should等等方法容易忘记,这里收集了下:<br />
INSTALL<br />
=======</p>
<p>$ gem install rspec</p>
<p>RSPEC-RAILS<br />
===========</p>
<p>  RAILS-3<br />
  =======</p>
<p>    CONFIGURE THE GEMFILE<br />
    ======================<br />
    group :development, :test do<br />
      gem &#8220;rspec-rails&#8221;, &#8220;~> 2.0&#8243;<br />
    end</p>
<p>    INSTALL THE BUNDLE<br />
    ===============================<br />
    $ bundle install</p>
<p>    BOOTSTRAP THE APP<br />
    =================<br />
    $ ./script/rails generate rspec:install<br />
          create  .rspec<br />
          create  spec<br />
          create  spec/spec_helper.rb<br />
          create  autotest<br />
          create  autotest/discover.rb</p>
<p>  RAILS-2<br />
  =======</p>
<p>    INSTALL<br />
    =======<br />
    $ gem install rspec-rails -v 1.3.3</p>
<p>    BOOTSTRAP THE APP<br />
    =================<br />
    $ ./script/generate rspec<br />
        create  spec<br />
        create  spec/spec_helper.rb<br />
        create  spec/spec.opts<br />
        create  previous_failures.txt<br />
        create  script/spec_server<br />
        create  script/spec</p>
<p>HOW TO USE<br />
==========</p>
<p>  COMMAND LINE<br />
  =============<br />
rspec &#8211;color &#8211;format doc spec/widget_spec.rb</p>
<p>  RAILS 3 (RSPEC 2)<br />
  =============<br />
./rails/generate model User<br />
rake -T spec # lists all rspec rake tasks<br />
rake spec # run all specs<br />
rake spec/models/mymodel_spec.rb # run a single spec file<br />
rake spec/models/mymodel_spec.rb:27 # run a single example or group on line 27</p>
<p>  RAILS 2 (RSPEC 1)<br />
  =============<br />
./script/generate rspec_model User<br />
rake -T spec # lists all rspec rake tasks<br />
rake spec # run all specs<br />
rake spec SPEC=spec/models/mymodel_spec.rb SPEC_OPTS=&#8221;-e \&#8221;should do<br />
something\&#8221;" #run a single spec</p>

<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="code"><pre class="rails" style="font-family:monospace;"><span style="color:#9966CC; font-weight:bold;">module</span> UserSpecHelper
  <span style="color:#9966CC; font-weight:bold;">def</span> valid_user_attributes
    <span style="color:#006600; font-weight:bold;">&#123;</span> <span style="color:#ff3333; font-weight:bold;">:email</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#996600;">&quot;joe@bloggs.com&quot;</span>,
      <span style="color:#ff3333; font-weight:bold;">:username</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#996600;">&quot;joebloggs&quot;</span>,
      <span style="color:#ff3333; font-weight:bold;">:password</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#996600;">&quot;abcdefg&quot;</span><span style="color:#006600; font-weight:bold;">&#125;</span>
  <span style="color:#9966CC; font-weight:bold;">end</span>
<span style="color:#9966CC; font-weight:bold;">end</span>
&nbsp;
&nbsp;
describe <span style="color:#996600;">&quot;A User (in general)&quot;</span> <span style="color:#9966CC; font-weight:bold;">do</span>
  <span style="color:#9966CC; font-weight:bold;">include</span> UserSpecHelper
&nbsp;
  before<span style="color:#006600; font-weight:bold;">&#40;</span>:<span style="color:#5A0A0A; font-weight:bold;">each</span><span style="color:#006600; font-weight:bold;">&#41;</span> <span style="color:#9966CC; font-weight:bold;">do</span>
    <span style="color:#0066ff; font-weight:bold;">@user</span> = User.<span style="color:#5A0A0A; font-weight:bold;">new</span>
  <span style="color:#9966CC; font-weight:bold;">end</span>
&nbsp;
  it <span style="color:#996600;">&quot;should be invalid without a username&quot;</span> <span style="color:#9966CC; font-weight:bold;">do</span>
    pending <span style="color:#996600;">&quot;some other thing we depend on&quot;</span>
    <span style="color:#0066ff; font-weight:bold;">@user</span>.<span style="color:#9900CC;">attributes</span> = valid_user_attributes.<span style="color:#9900CC;">except</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#ff3333; font-weight:bold;">:username</span><span style="color:#006600; font-weight:bold;">&#41;</span>
    <span style="color:#0066ff; font-weight:bold;">@user</span>.<span style="color:#9900CC;">should_not</span> be_valid
    <span style="color:#0066ff; font-weight:bold;">@user</span>.<span style="color:#9900CC;">should</span> have<span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#006666;">1</span><span style="color:#006600; font-weight:bold;">&#41;</span>.<span style="color:#9900CC;">error_on</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#ff3333; font-weight:bold;">:username</span><span style="color:#006600; font-weight:bold;">&#41;</span>
    <span style="color:#0066ff; font-weight:bold;">@user</span>.<span style="color:#5A0A0A; font-weight:bold;">errors</span>.<span style="color:#9900CC;">on</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#ff3333; font-weight:bold;">:username</span><span style="color:#006600; font-weight:bold;">&#41;</span>.<span style="color:#9900CC;">should</span> == <span style="color:#996600;">&quot;is required&quot;</span>
    <span style="color:#0066ff; font-weight:bold;">@user</span>.<span style="color:#9900CC;">username</span> = <span style="color:#996600;">&quot;someusername&quot;</span>
    <span style="color:#0066ff; font-weight:bold;">@user</span>.<span style="color:#9900CC;">should</span> be_valid
  <span style="color:#9966CC; font-weight:bold;">end</span>
<span style="color:#9966CC; font-weight:bold;">end</span></pre></td></tr></table></div>

<p>EXPECTATIONS<br />
=====================</p>

<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
</pre></td><td class="code"><pre class="rails" style="font-family:monospace;">target.<span style="color:#9900CC;">should</span> satisfy <span style="color:#006600; font-weight:bold;">&#123;</span><span style="color:#006600; font-weight:bold;">|</span>arg<span style="color:#006600; font-weight:bold;">|</span> ...<span style="color:#006600; font-weight:bold;">&#125;</span>
target.<span style="color:#9900CC;">should_not</span> satisfy <span style="color:#006600; font-weight:bold;">&#123;</span><span style="color:#006600; font-weight:bold;">|</span>arg<span style="color:#006600; font-weight:bold;">|</span> ...<span style="color:#006600; font-weight:bold;">&#125;</span>
&nbsp;
target.<span style="color:#9900CC;">should</span> equal <span style="color:#006600; font-weight:bold;">&lt;</span>value<span style="color:#006600; font-weight:bold;">&gt;</span>
target.<span style="color:#9900CC;">should_not</span> equal <span style="color:#006600; font-weight:bold;">&lt;</span>value<span style="color:#006600; font-weight:bold;">&gt;</span>
&nbsp;
target.<span style="color:#9900CC;">should</span> be_close <span style="color:#006600; font-weight:bold;">&lt;</span>value<span style="color:#006600; font-weight:bold;">&gt;</span>, <span style="color:#006600; font-weight:bold;">&lt;</span>tolerance<span style="color:#006600; font-weight:bold;">&gt;</span>
target.<span style="color:#9900CC;">should_not</span> be_close <span style="color:#006600; font-weight:bold;">&lt;</span>value<span style="color:#006600; font-weight:bold;">&gt;</span>, <span style="color:#006600; font-weight:bold;">&lt;</span>tolerance<span style="color:#006600; font-weight:bold;">&gt;</span>
&nbsp;
target.<span style="color:#9900CC;">should</span> be <span style="color:#006600; font-weight:bold;">&lt;</span>value<span style="color:#006600; font-weight:bold;">&gt;</span>
target.<span style="color:#9900CC;">should_not</span> be <span style="color:#006600; font-weight:bold;">&lt;</span>value<span style="color:#006600; font-weight:bold;">&gt;</span>
&nbsp;
target.<span style="color:#9900CC;">should</span> predicate <span style="color:#006600; font-weight:bold;">&#91;</span>optional args<span style="color:#006600; font-weight:bold;">&#93;</span>
target.<span style="color:#9900CC;">should</span> be_predicate <span style="color:#006600; font-weight:bold;">&#91;</span>optional args<span style="color:#006600; font-weight:bold;">&#93;</span>
target.<span style="color:#9900CC;">should_not</span> predicate <span style="color:#006600; font-weight:bold;">&#91;</span>optional args<span style="color:#006600; font-weight:bold;">&#93;</span>
target.<span style="color:#9900CC;">should_not</span> be_predicate <span style="color:#006600; font-weight:bold;">&#91;</span>optional args<span style="color:#006600; font-weight:bold;">&#93;</span>
&nbsp;
target.<span style="color:#9900CC;">should</span> be <span style="color:#006600; font-weight:bold;">&lt;</span> <span style="color:#006666;">6</span>
target.<span style="color:#9900CC;">should</span> == <span style="color:#006666;">5</span>
target.<span style="color:#9900CC;">should</span> be_between<span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#006666;">1</span>, <span style="color:#006666;">10</span><span style="color:#006600; font-weight:bold;">&#41;</span>
target.<span style="color:#9900CC;">should_not</span> == <span style="color:#996600;">'Samantha'</span>
&nbsp;
target.<span style="color:#9900CC;">should</span> match <span style="color:#006600; font-weight:bold;">&lt;</span>regex<span style="color:#006600; font-weight:bold;">&gt;</span>
target.<span style="color:#9900CC;">should_not</span> match <span style="color:#006600; font-weight:bold;">&lt;</span>regex<span style="color:#006600; font-weight:bold;">&gt;</span>
&nbsp;
target.<span style="color:#9900CC;">should</span> be_an_instance_of <span style="color:#006600; font-weight:bold;">&lt;</span>class<span style="color:#006600; font-weight:bold;">&gt;</span>
target.<span style="color:#9900CC;">should_not</span> be_an_instance_of <span style="color:#006600; font-weight:bold;">&lt;</span>class<span style="color:#006600; font-weight:bold;">&gt;</span>
&nbsp;
target.<span style="color:#9900CC;">should</span> be_a_kind_of <span style="color:#006600; font-weight:bold;">&lt;</span>class<span style="color:#006600; font-weight:bold;">&gt;</span>
target.<span style="color:#9900CC;">should_not</span> be_a_kind_of <span style="color:#006600; font-weight:bold;">&lt;</span>class<span style="color:#006600; font-weight:bold;">&gt;</span>
&nbsp;
target.<span style="color:#9900CC;">should</span> <span style="color:#5A0A0A; font-weight:bold;">respond_to</span> <span style="color:#006600; font-weight:bold;">&lt;</span>symbol<span style="color:#006600; font-weight:bold;">&gt;</span>
target.<span style="color:#9900CC;">should_not</span> <span style="color:#5A0A0A; font-weight:bold;">respond_to</span> <span style="color:#006600; font-weight:bold;">&lt;</span>symbol<span style="color:#006600; font-weight:bold;">&gt;</span>
&nbsp;
<span style="color:#CC0066; font-weight:bold;">lambda</span> <span style="color:#006600; font-weight:bold;">&#123;</span>a_call<span style="color:#006600; font-weight:bold;">&#125;</span>.<span style="color:#9900CC;">should</span> raise_error
<span style="color:#CC0066; font-weight:bold;">lambda</span> <span style="color:#006600; font-weight:bold;">&#123;</span>a_call<span style="color:#006600; font-weight:bold;">&#125;</span>.<span style="color:#9900CC;">should</span> raise_error<span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#006600; font-weight:bold;">&lt;</span>exception<span style="color:#006600; font-weight:bold;">&gt;</span> <span style="color:#006600; font-weight:bold;">&#91;</span>, message<span style="color:#006600; font-weight:bold;">&#93;</span><span style="color:#006600; font-weight:bold;">&#41;</span>
<span style="color:#CC0066; font-weight:bold;">lambda</span> <span style="color:#006600; font-weight:bold;">&#123;</span>a_call<span style="color:#006600; font-weight:bold;">&#125;</span>.<span style="color:#9900CC;">should_not</span> raise_error
<span style="color:#CC0066; font-weight:bold;">lambda</span> <span style="color:#006600; font-weight:bold;">&#123;</span>a_call<span style="color:#006600; font-weight:bold;">&#125;</span>.<span style="color:#9900CC;">should_not</span> raise_error<span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#006600; font-weight:bold;">&lt;</span>exception<span style="color:#006600; font-weight:bold;">&gt;</span> <span style="color:#006600; font-weight:bold;">&#91;</span>, message<span style="color:#006600; font-weight:bold;">&#93;</span><span style="color:#006600; font-weight:bold;">&#41;</span>
<span style="color:#CC0066; font-weight:bold;">lambda</span> <span style="color:#006600; font-weight:bold;">&#123;</span>a_call<span style="color:#006600; font-weight:bold;">&#125;</span>.<span style="color:#9900CC;">should</span> change<span style="color:#006600; font-weight:bold;">&#40;</span>instance, method<span style="color:#006600; font-weight:bold;">&#41;</span>.<span style="color:#9900CC;">from</span><span style="color:#006600; font-weight:bold;">&#40;</span>number<span style="color:#006600; font-weight:bold;">&#41;</span>.<span style="color:#9900CC;">to</span><span style="color:#006600; font-weight:bold;">&#40;</span>number<span style="color:#006600; font-weight:bold;">&#41;</span>
&nbsp;
<span style="color:#CC0066; font-weight:bold;">proc</span>.<span style="color:#9900CC;">should</span> throw <span style="color:#006600; font-weight:bold;">&lt;</span>symbol<span style="color:#006600; font-weight:bold;">&gt;</span>
<span style="color:#CC0066; font-weight:bold;">proc</span>.<span style="color:#9900CC;">should_not</span> throw <span style="color:#006600; font-weight:bold;">&lt;</span>symbol<span style="color:#006600; font-weight:bold;">&gt;</span>
&nbsp;
target.<span style="color:#9900CC;">should</span> <span style="color:#9966CC; font-weight:bold;">include</span> <span style="color:#006600; font-weight:bold;">&lt;</span>object<span style="color:#006600; font-weight:bold;">&gt;</span>
target.<span style="color:#9900CC;">should_not</span> <span style="color:#9966CC; font-weight:bold;">include</span> <span style="color:#006600; font-weight:bold;">&lt;</span>object<span style="color:#006600; font-weight:bold;">&gt;</span>
&nbsp;
target.<span style="color:#9900CC;">should</span> have<span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#006600; font-weight:bold;">&lt;</span>number<span style="color:#006600; font-weight:bold;">&gt;</span><span style="color:#006600; font-weight:bold;">&#41;</span>.<span style="color:#9900CC;">things</span>
target.<span style="color:#9900CC;">should</span> have_at_least<span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#006600; font-weight:bold;">&lt;</span>number<span style="color:#006600; font-weight:bold;">&gt;</span><span style="color:#006600; font-weight:bold;">&#41;</span>.<span style="color:#9900CC;">things</span>
target.<span style="color:#9900CC;">should</span> have_at_most<span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#006600; font-weight:bold;">&lt;</span>number<span style="color:#006600; font-weight:bold;">&gt;</span><span style="color:#006600; font-weight:bold;">&#41;</span>.<span style="color:#9900CC;">things</span>
&nbsp;
target.<span style="color:#9900CC;">should</span> have<span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#006600; font-weight:bold;">&lt;</span>number<span style="color:#006600; font-weight:bold;">&gt;</span><span style="color:#006600; font-weight:bold;">&#41;</span>.<span style="color:#9900CC;">errors_on</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#ff3333; font-weight:bold;">:field</span><span style="color:#006600; font-weight:bold;">&#41;</span>
&nbsp;
expect <span style="color:#006600; font-weight:bold;">&#123;</span> thing.<span style="color:#9900CC;">approve</span>! <span style="color:#006600; font-weight:bold;">&#125;</span>.<span style="color:#9900CC;">to</span> change<span style="color:#006600; font-weight:bold;">&#40;</span>thing, <span style="color:#ff3333; font-weight:bold;">:status</span><span style="color:#006600; font-weight:bold;">&#41;</span>.
    <span style="color:#9900CC;">from</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#6666ff; font-weight:bold;">Status::AWAITING_APPROVAL</span><span style="color:#006600; font-weight:bold;">&#41;</span>.
    <span style="color:#9900CC;">to</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#6666ff; font-weight:bold;">Status::APPROVED</span><span style="color:#006600; font-weight:bold;">&#41;</span>
&nbsp;
expect <span style="color:#006600; font-weight:bold;">&#123;</span> thing.<span style="color:#5A0A0A; font-weight:bold;">destroy</span> <span style="color:#006600; font-weight:bold;">&#125;</span>.<span style="color:#9900CC;">to</span> change<span style="color:#006600; font-weight:bold;">&#40;</span>Thing, :<span style="color:#5A0A0A; font-weight:bold;">count</span><span style="color:#006600; font-weight:bold;">&#41;</span>.<span style="color:#9900CC;">by</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#006600; font-weight:bold;">-</span><span style="color:#006666;">1</span><span style="color:#006600; font-weight:bold;">&#41;</span></pre></td></tr></table></div>

<p>Mocks and Stubs(打桩)<br />
===============</p>

<div class="wp_syntax"><table><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="code"><pre class="rails" style="font-family:monospace;">user_mock = mock <span style="color:#996600;">&quot;User&quot;</span>
user_mock.<span style="color:#9900CC;">should_receive</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#ff3333; font-weight:bold;">:authenticate</span><span style="color:#006600; font-weight:bold;">&#41;</span>.<span style="color:#9900CC;">with</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">&quot;password&quot;</span><span style="color:#006600; font-weight:bold;">&#41;</span>.<span style="color:#9900CC;">and_return</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#0000FF; font-weight:bold;">true</span><span style="color:#006600; font-weight:bold;">&#41;</span>
user_mock.<span style="color:#9900CC;">should_receive</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#ff3333; font-weight:bold;">:coffee</span><span style="color:#006600; font-weight:bold;">&#41;</span>.<span style="color:#9900CC;">exactly</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#006666;">3</span><span style="color:#006600; font-weight:bold;">&#41;</span>.<span style="color:#9900CC;">times</span>.<span style="color:#9900CC;">and_return</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#ff3333; font-weight:bold;">:americano</span><span style="color:#006600; font-weight:bold;">&#41;</span>
user_mock.<span style="color:#9900CC;">should_receive</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#ff3333; font-weight:bold;">:coffee</span><span style="color:#006600; font-weight:bold;">&#41;</span>.<span style="color:#9900CC;">exactly</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#006666;">5</span><span style="color:#006600; font-weight:bold;">&#41;</span>.<span style="color:#9900CC;">times</span>.<span style="color:#9900CC;">and_raise</span><span style="color:#006600; font-weight:bold;">&#40;</span>NotEnoughCoffeeExcep
ion<span style="color:#006600; font-weight:bold;">&#41;</span>
&nbsp;
people_stub = mock <span style="color:#996600;">&quot;people&quot;</span>
people_stub.<span style="color:#9900CC;">stub</span>!<span style="color:#006600; font-weight:bold;">&#40;</span>:<span style="color:#5A0A0A; font-weight:bold;">each</span><span style="color:#006600; font-weight:bold;">&#41;</span>.<span style="color:#9900CC;">and_yield</span><span style="color:#006600; font-weight:bold;">&#40;</span>mock_user<span style="color:#006600; font-weight:bold;">&#41;</span>
people_stub.<span style="color:#9900CC;">stub</span>!<span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#ff3333; font-weight:bold;">:bad_method</span><span style="color:#006600; font-weight:bold;">&#41;</span>.<span style="color:#9900CC;">and_raise</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#CC00FF; font-weight:bold;">RuntimeError</span><span style="color:#006600; font-weight:bold;">&#41;</span>
&nbsp;
user_stub = mock_model<span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">&quot;User&quot;</span>, <span style="color:#ff3333; font-weight:bold;">:id</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#006666;">23</span>, <span style="color:#ff3333; font-weight:bold;">:username</span> <span style="color:#006600; font-weight:bold;">=&gt;</span> <span style="color:#996600;">&quot;pat&quot;</span>, <span style="color:#ff3333; font-weight:bold;">:email</span> <span style="color:#006600; font-weight:bold;">=&gt;</span>
<span style="color:#996600;">&quot;pat@example.com&quot;</span><span style="color:#006600; font-weight:bold;">&#41;</span>
&nbsp;
my_instance.<span style="color:#9900CC;">stub</span>!<span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#ff3333; font-weight:bold;">:msg</span><span style="color:#006600; font-weight:bold;">&#41;</span>.<span style="color:#9900CC;">and_return</span><span style="color:#006600; font-weight:bold;">&#40;</span>value<span style="color:#006600; font-weight:bold;">&#41;</span>
MyClass.<span style="color:#9900CC;">stub</span>!<span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#ff3333; font-weight:bold;">:msg</span><span style="color:#006600; font-weight:bold;">&#41;</span>.<span style="color:#9900CC;">and_return</span><span style="color:#006600; font-weight:bold;">&#40;</span>value<span style="color:#006600; font-weight:bold;">&#41;</span></pre></td></tr></table></div>

<p>Examples (in the real world)</p>
<p>============================</p>
<p>http://madhatted.com/2008/7/10/rspec-real-world-testing</p>
<p>presentation: http://kerryb.github.com/iprug-rspec-presentation/#31<br />
&nbsp;</p>
]]></content:encoded>
			<wfw:commentRss>http://imzc.net/archives/267/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>六月随笔</title>
		<link>http://imzc.net/archives/265/</link>
		<comments>http://imzc.net/archives/265/#comments</comments>
		<pubDate>Mon, 02 Jul 2012 05:07:49 +0000</pubDate>
		<dc:creator>imzc</dc:creator>
				<category><![CDATA[Other]]></category>

		<guid isPermaLink="false">http://imzc.net/?p=265</guid>
		<description><![CDATA[整整六月份,没有写一篇文章,原因很多. 六月,公司旅游,加上请年假回家,貌似工作的时间不是特别多.一年半没有回 [...]]]></description>
			<content:encoded><![CDATA[<p>整整六月份,没有写一篇文章,原因很多.</p>
<p>六月,公司旅游,加上请年假回家,貌似工作的时间不是特别多.一年半没有回老家了,感触颇多;好多人的头发变白了,公路也修到家门口了,儿时的玩伴一个都找不到了,大家各奔东西,在外地打拼着&#8230;</p>
<p>七月份努力啦~工作和学习都需要一个提升!</p>
<p>最近发生的事情中,想说说自己的看法:</p>
<p>1. 微软确认现有WP7手机将不支持升级WP8</p>
<p>对于微软WP7系列的机子,不支持升级到WP8,<a title="微软确认现有WP7手机将不支持升级WP8" href="http://www.pcpop.com/doc/0/807/807363.shtml" target="_blank">这条新闻</a>让我很是郁闷了一把,才买不久的lumia800就这样悲剧了.现在诺基亚的CEO看起来就是微软的卧底,Nokia没落了&#8230;苹果的iphone 3GS,从最开始的IOS3到现在的IOS5,多少的版本,尽管是部分新特性不能使用,但是比较都支持升级,能流畅使用;对于微软,就WP7.X的半残品,开发权限也少,所谓的游戏,卖得比苹果appstore贵,但是质量确实相差十万八千里,真是不小的差距.最近,微软又放出消息,说<a href="http://cnbeta.com/articles/194904.htm" target="_blank">WP8用户将不需担心WP7时的尴尬升级情况</a>,这个真是忽悠人不打草稿的;估计到时候WP9出来时,还会重复同样的悲剧.</p>
<p>这一次,微软又寒了机友们的心啊&#8230;除了电脑操作系统在某些场合不得不用win7的情况下,我准备远离微软的产品. 顺便说一句,Mac Lion体验确实还是可以的,由于苹果产品在中国越来越畅销,现在国内很多应用都有了mac版本.网银也能在mac下面使用了.赞一个~</p>
<p>2. 今天的消息:</p>
<p><a href="http://tech.qq.com/a/20120702/000165.htm" target="_blank">苹果向唯冠支付6000万美元 iPad商标案和解</a>,这个估计比较震撼吧,价格在我看来,对唯冠来说,应该还算可以了.苹果真是有钱的主啊!~再次体现了知识产权的重要性啊.要创业的童鞋们注意了,在决定开发什么产品或者创立公司时,一定要完整的申请自己的域名,商标.相对于后期的投入,前期自己申请时花的钱估计是略微不计的了.</p>
<p>&nbsp;</p>
<blockquote><p>最后,说说现阶段的计划:</p>
<p>1.工作: rails学习,包括机制的熟悉.配合工作,加入到ATM3.0开发中.ruby应用,新技术或者是一些技巧用得较多,需要好好理解~思维方式需要转变到ROR上来.</p>
<p>2.业余:IOS开发学习继续,为了配合工作,决定试着开发一款客户端+服务端(ROR)的应用,内容构思中&#8230;</p>
<p>3.生活:做上存钱计划,今早还清房贷;另外,每周至少有半天陪陪GF.</p></blockquote>
]]></content:encoded>
			<wfw:commentRss>http://imzc.net/archives/265/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>ios5实现访问通话记录(需越狱)</title>
		<link>http://imzc.net/archives/259/</link>
		<comments>http://imzc.net/archives/259/#comments</comments>
		<pubDate>Sun, 06 May 2012 06:42:55 +0000</pubDate>
		<dc:creator>imzc</dc:creator>
				<category><![CDATA[IOSDev]]></category>

		<guid isPermaLink="false">http://imzc.net/?p=259</guid>
		<description><![CDATA[ios5的通话记录都保存在一个sqlite db文件中: 可以用下面代码测试，能否访问到对应的db： -&#4 [...]]]></description>
			<content:encoded><![CDATA[<p>ios5的通话记录都保存在一个sqlite db文件中:</p>
<p>可以用下面代码测试，能否访问到对应的db：</p>

<div class="wp_syntax"><div class="code"><pre class="c_mac" style="font-family:monospace;"><span style="color: #000000;">-</span><span style="color: #000000;">&#40;</span>IBAction<span style="color: #000000;">&#41;</span>checkDBClick<span style="color: #000000;">:</span><span style="color: #000000;">&#40;</span>id<span style="color: #000000;">&#41;</span>sender<span style="color: #000000;">&#123;</span>
	NSFileManager <span style="color: #000000;">*</span>fileManager <span style="color: #000000;">=</span> <span style="color: #000000;">&#91;</span>NSFileManager defaultManager<span style="color: #000000;">&#93;</span>; 
	NSDirectoryEnumerator <span style="color: #000000;">*</span>dirnum <span style="color: #000000;">=</span> <span style="color: #000000;">&#91;</span><span style="color: #000000;">&#91;</span>NSFileManager defaultManager<span style="color: #000000;">&#93;</span> enumeratorAtPath<span style="color: #000000;">:</span> @<span style="color: #666666;">&quot;/private/&quot;</span><span style="color: #000000;">&#93;</span>; 
	NSString <span style="color: #000000;">*</span>nextItem <span style="color: #000000;">=</span> <span style="color: #000000;">&#91;</span>NSString string<span style="color: #000000;">&#93;</span>; 
	NSUInteger pos <span style="color: #000000;">=</span> <span style="color: #0000dd;">0</span>;		
	uTextView.<span style="color: #00eeff;">text</span>  <span style="color: #000000;">=</span> @<span style="color: #666666;">&quot;checkDBClick&quot;</span>;	
	<span style="color: #0000ff;">while</span><span style="color: #000000;">&#40;</span> <span style="color: #000000;">&#40;</span>nextItem <span style="color: #000000;">=</span> <span style="color: #000000;">&#91;</span>dirnum nextObject<span style="color: #000000;">&#93;</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
		<span style="color: #0000ff;">if</span> <span style="color: #000000;">&#40;</span><span style="color: #000000;">&#91;</span><span style="color: #000000;">&#91;</span>nextItem pathExtension<span style="color: #000000;">&#93;</span> isEqualToString<span style="color: #000000;">:</span> @<span style="color: #666666;">&quot;db&quot;</span><span style="color: #000000;">&#93;</span> || 
			<span style="color: #000000;">&#91;</span><span style="color: #000000;">&#91;</span>nextItem pathExtension<span style="color: #000000;">&#93;</span> isEqualToString<span style="color: #000000;">:</span> @<span style="color: #666666;">&quot;sqlitedb&quot;</span><span style="color: #000000;">&#93;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span> 
			<span style="color: #0000ff;">if</span> <span style="color: #000000;">&#40;</span><span style="color: #000000;">&#91;</span>fileManager isReadableFileAtPath<span style="color: #000000;">:</span>nextItem<span style="color: #000000;">&#93;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span> 
				NSLog<span style="color: #000000;">&#40;</span>@<span style="color: #666666;">&quot;%@&quot;</span>, nextItem<span style="color: #000000;">&#41;</span>; 
				pos<span style="color: #000000;">++</span>;
				NSString <span style="color: #000000;">*</span> tmp <span style="color: #000000;">=</span> <span style="color: #000000;">&#91;</span><span style="color: #000000;">&#91;</span>NSString alloc<span style="color: #000000;">&#93;</span> initWithFormat<span style="color: #000000;">:</span>@<span style="color: #666666;">&quot;%@<span style="color: #000099; font-weight: bold;">\n</span>next(%d):%@&quot;</span>,uTextView.<span style="color: #00eeff;">text</span>,pos,nextItem<span style="color: #000000;">&#93;</span>;
				uTextView.<span style="color: #00eeff;">text</span> <span style="color: #000000;">=</span> tmp;
&nbsp;
				<span style="color: #000000;">&#91;</span>tmp release<span style="color: #000000;">&#93;</span>;
			<span style="color: #000000;">&#125;</span> 
		<span style="color: #000000;">&#125;</span> 
	<span style="color: #000000;">&#125;</span>
<span style="color: #000000;">&#125;</span></pre></div></div>

<p>&nbsp;</p>
<p>ios5中，位于目录： /private/var/wireless/Library/CallHistory/call_history.db 下。由于ios5以后，所有程序运行在沙盒下，仅能访问程序自己的目录，以及有限的几个目录，故，在不越狱的情况下，是访问不到对应的数据的。程序中用到的telocation.db，来电归属地数据库，请直接google得到。<br />
PS：有谁能在不越狱的基础上，利用私有API或者其他方式获取到手机号的话，麻烦email我一下方法，多谢~~~<br />
假定已经获得了手机号码，可通过下述代码获取，并得到对应的归属地：</p>

<div class="wp_syntax"><div class="code"><pre class="c_mac" style="font-family:monospace;">&nbsp;
<span style="color: #000000;">-</span><span style="color: #000000;">&#40;</span>NSString <span style="color: #000000;">*</span><span style="color: #000000;">&#41;</span>getPhoneNumberLocation<span style="color: #000000;">:</span> <span style="color: #000000;">&#40;</span>NSString <span style="color: #000000;">*</span> <span style="color: #000000;">&#41;</span>phoneNum<span style="color: #000000;">&#123;</span>
	<span style="color: #ff0000;">//call area </span>
&nbsp;
	NSString <span style="color: #000000;">*</span>teLocationDatabasePath <span style="color: #000000;">=</span> <span style="color: #000000;">&#91;</span><span style="color: #000000;">&#91;</span>NSString alloc<span style="color: #000000;">&#93;</span> initWithFormat<span style="color: #000000;">:</span>@<span style="color: #666666;">&quot;%@/%@&quot;</span>,<span style="color: #000000;">&#91;</span><span style="color: #000000;">&#91;</span>NSBundle mainBundle<span style="color: #000000;">&#93;</span> resourcePath<span style="color: #000000;">&#93;</span>, @<span style="color: #666666;">&quot;telocation.db&quot;</span><span style="color: #000000;">&#93;</span>;
	BOOL dbFileExist <span style="color: #000000;">=</span> FALSE;
	NSMutableString <span style="color: #000000;">*</span> area <span style="color: #000000;">=</span> <span style="color: #000000;">&#91;</span><span style="color: #000000;">&#91;</span><span style="color: #000000;">&#91;</span>NSMutableString alloc<span style="color: #000000;">&#93;</span> autorelease<span style="color: #000000;">&#93;</span> initWithString<span style="color: #000000;">:</span>@<span style="color: #666666;">&quot;&quot;</span><span style="color: #000000;">&#93;</span>;
&nbsp;
	NSFileManager <span style="color: #000000;">*</span>fileManager <span style="color: #000000;">=</span> <span style="color: #000000;">&#91;</span>NSFileManager defaultManager<span style="color: #000000;">&#93;</span>; 
	dbFileExist <span style="color: #000000;">=</span> <span style="color: #000000;">&#91;</span>fileManager fileExistsAtPath<span style="color: #000000;">:</span>teLocationDatabasePath<span style="color: #000000;">&#93;</span>;
	<span style="color: #000000;">&#91;</span>fileManager release<span style="color: #000000;">&#93;</span>; 
&nbsp;
	NSLog<span style="color: #000000;">&#40;</span>@<span style="color: #666666;">&quot;teLocationDatabasePath:%@&quot;</span>,teLocationDatabasePath<span style="color: #000000;">&#41;</span>;
&nbsp;
	<span style="color: #0000ff;">if</span><span style="color: #000000;">&#40;</span>dbFileExist<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
		<span style="color: #0000ff;">if</span> <span style="color: #000000;">&#40;</span><span style="color: #000000;">&#91;</span>fileManager isReadableFileAtPath<span style="color: #000000;">:</span>teLocationDatabasePath<span style="color: #000000;">&#93;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
			sqlite3 <span style="color: #000000;">*</span>database;
			<span style="color: #0000ff;">if</span><span style="color: #000000;">&#40;</span>sqlite3_open<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#91;</span>teLocationDatabasePath UTF8String<span style="color: #000000;">&#93;</span>, <span style="color: #000000;">&amp;</span>database<span style="color: #000000;">&#41;</span> <span style="color: #000000;">==</span> SQLITE_OK<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
				sqlite3_stmt <span style="color: #000000;">*</span>compiledStatement;
				NSString <span style="color: #000000;">*</span>sqlStatement <span style="color: #000000;">=</span> <span style="color: #000000;">&#91;</span>NSString stringWithFormat<span style="color: #000000;">:</span>@<span style="color: #666666;">&quot;SELECT * FROM mob_location WHERE _id='%@';&quot;</span>,<span style="color: #000000;">&#91;</span>phoneNum substringToIndex<span style="color: #000000;">:</span><span style="color: #0000dd;">7</span><span style="color: #000000;">&#93;</span><span style="color: #000000;">&#93;</span>;
				NSLog<span style="color: #000000;">&#40;</span>@<span style="color: #666666;">&quot;sql:%@&quot;</span>,sqlStatement<span style="color: #000000;">&#41;</span>;
&nbsp;
&nbsp;
				<span style="color: #0000ff;">int</span> errorCode <span style="color: #000000;">=</span> sqlite3_prepare_v2<span style="color: #000000;">&#40;</span>database, <span style="color: #000000;">&#91;</span>sqlStatement UTF8String<span style="color: #000000;">&#93;</span>, <span style="color: #000000;">-</span><span style="color: #0000dd;">1</span>, 
												   <span style="color: #000000;">&amp;</span>compiledStatement, <span style="color: #0000ff;">NULL</span><span style="color: #000000;">&#41;</span>;
				<span style="color: #0000ff;">if</span><span style="color: #000000;">&#40;</span> errorCode <span style="color: #000000;">==</span> SQLITE_OK<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
					<span style="color: #0000ff;">int</span> count <span style="color: #000000;">=</span> <span style="color: #0000dd;">1</span>;
&nbsp;
					<span style="color: #0000ff;">while</span><span style="color: #000000;">&#40;</span>sqlite3_step<span style="color: #000000;">&#40;</span>compiledStatement<span style="color: #000000;">&#41;</span> <span style="color: #000000;">==</span> SQLITE_ROW<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
						<span style="color: #ff0000;">// Read the data from the result row</span>
						<span style="color: #0000ff;">int</span> numberOfColumns <span style="color: #000000;">=</span> sqlite3_column_count<span style="color: #000000;">&#40;</span>compiledStatement<span style="color: #000000;">&#41;</span>;
						NSString <span style="color: #000000;">*</span>data;
						NSString <span style="color: #000000;">*</span>columnName;
&nbsp;
						<span style="color: #0000ff;">for</span> <span style="color: #000000;">&#40;</span><span style="color: #0000ff;">int</span> i <span style="color: #000000;">=</span> <span style="color: #0000dd;">0</span>; i &lt; numberOfColumns; i<span style="color: #000000;">++</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
							columnName <span style="color: #000000;">=</span> <span style="color: #000000;">&#91;</span><span style="color: #000000;">&#91;</span>NSString alloc<span style="color: #000000;">&#93;</span> initWithUTF8String<span style="color: #000000;">:</span>
										  <span style="color: #000000;">&#40;</span><span style="color: #0000ff;">char</span> <span style="color: #000000;">*</span><span style="color: #000000;">&#41;</span>sqlite3_column_name<span style="color: #000000;">&#40;</span>compiledStatement, i<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#93;</span>;
							data <span style="color: #000000;">=</span> <span style="color: #000000;">&#91;</span><span style="color: #000000;">&#91;</span>NSString alloc<span style="color: #000000;">&#93;</span> initWithUTF8String<span style="color: #000000;">:</span>
									<span style="color: #000000;">&#40;</span><span style="color: #0000ff;">char</span> <span style="color: #000000;">*</span><span style="color: #000000;">&#41;</span>sqlite3_column_text<span style="color: #000000;">&#40;</span>compiledStatement, i<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#93;</span>;
&nbsp;
&nbsp;
&nbsp;
							<span style="color: #0000ff;">if</span> <span style="color: #000000;">&#40;</span><span style="color: #000000;">&#91;</span>columnName isEqualToString<span style="color: #000000;">:</span>@<span style="color: #666666;">&quot;location&quot;</span><span style="color: #000000;">&#93;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span> 
								<span style="color: #000000;">&#91;</span>area appendString<span style="color: #000000;">:</span>data<span style="color: #000000;">&#93;</span>;
&nbsp;
								NSLog<span style="color: #000000;">&#40;</span>@<span style="color: #666666;">&quot;%d:%@=&gt;%@&quot;</span>,count,columnName,data<span style="color: #000000;">&#41;</span>;
							<span style="color: #000000;">&#125;</span>
							<span style="color: #000000;">&#91;</span>columnName release<span style="color: #000000;">&#93;</span>;
							<span style="color: #000000;">&#91;</span>data release<span style="color: #000000;">&#93;</span>;
						<span style="color: #000000;">&#125;</span>  
						count<span style="color: #000000;">++</span>;
					<span style="color: #000000;">&#125;</span>
&nbsp;
				<span style="color: #000000;">&#125;</span>
				<span style="color: #0000ff;">else</span> <span style="color: #000000;">&#123;</span>
					NSLog<span style="color: #000000;">&#40;</span>@<span style="color: #666666;">&quot;Failed to retrieve table&quot;</span><span style="color: #000000;">&#41;</span>;
					NSLog<span style="color: #000000;">&#40;</span>@<span style="color: #666666;">&quot;Error Code: %d&quot;</span>, errorCode<span style="color: #000000;">&#41;</span>;
				<span style="color: #000000;">&#125;</span>
				sqlite3_finalize<span style="color: #000000;">&#40;</span>compiledStatement<span style="color: #000000;">&#41;</span>;
			<span style="color: #000000;">&#125;</span>
		<span style="color: #000000;">&#125;</span>
&nbsp;
	<span style="color: #000000;">&#125;</span>
	<span style="color: #000000;">&#91;</span>teLocationDatabasePath release<span style="color: #000000;">&#93;</span>;
	NSLog<span style="color: #000000;">&#40;</span>@<span style="color: #666666;">&quot;area:%@&quot;</span>,area<span style="color: #000000;">&#41;</span>;
	<span style="color: #0000ff;">return</span> area;
<span style="color: #000000;">&#125;</span>
&nbsp;
<span style="color: #000000;">-</span><span style="color: #000000;">&#40;</span>IBAction<span style="color: #000000;">&#41;</span>getInfoClick<span style="color: #000000;">:</span><span style="color: #000000;">&#40;</span>id<span style="color: #000000;">&#41;</span>sender<span style="color: #000000;">&#123;</span>
&nbsp;
<span style="color: #339900;">#define DB_FILE  [[NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) objectAtIndex:0] stringByAppendingPathComponent:@&quot;call_history.db&quot;]</span>
&nbsp;
	NSLog<span style="color: #000000;">&#40;</span>@<span style="color: #666666;">&quot;getInfoClick:%@&quot;</span>,DB_FILE<span style="color: #000000;">&#41;</span>;
	uTextView.<span style="color: #00eeff;">text</span> <span style="color: #000000;">=</span> @<span style="color: #666666;">&quot;getInfoClick:&quot;</span>; 
&nbsp;
	NSFileManager <span style="color: #000000;">*</span>fileManager <span style="color: #000000;">=</span> <span style="color: #000000;">&#91;</span>NSFileManager defaultManager<span style="color: #000000;">&#93;</span>; 	
	NSString <span style="color: #000000;">*</span>callHisoryDatabasePath <span style="color: #000000;">=</span> DB_FILE;<span style="color: #ff0000;">//@&quot;/private/var/wireless/Library/CallHistory/call_history.db&quot;;</span>
	BOOL callHistoryFileExist <span style="color: #000000;">=</span> FALSE;
	callHistoryFileExist <span style="color: #000000;">=</span> <span style="color: #000000;">&#91;</span>fileManager fileExistsAtPath<span style="color: #000000;">:</span>callHisoryDatabasePath<span style="color: #000000;">&#93;</span>;
	<span style="color: #ff0000;">//	[fileManager release];</span>
	NSMutableArray <span style="color: #000000;">*</span>callHistory <span style="color: #000000;">=</span> <span style="color: #000000;">&#91;</span><span style="color: #000000;">&#91;</span>NSMutableArray alloc<span style="color: #000000;">&#93;</span> init<span style="color: #000000;">&#93;</span>;
&nbsp;
&nbsp;
	<span style="color: #0000ff;">if</span><span style="color: #000000;">&#40;</span>callHistoryFileExist<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
		NSLog<span style="color: #000000;">&#40;</span>@<span style="color: #666666;">&quot;path is exists...&quot;</span><span style="color: #000000;">&#41;</span>;
		<span style="color: #0000ff;">if</span> <span style="color: #000000;">&#40;</span><span style="color: #000000;">&#91;</span>fileManager isReadableFileAtPath<span style="color: #000000;">:</span>callHisoryDatabasePath<span style="color: #000000;">&#93;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
			NSLog<span style="color: #000000;">&#40;</span>@<span style="color: #666666;">&quot;path can read...&quot;</span><span style="color: #000000;">&#41;</span>;
			sqlite3 <span style="color: #000000;">*</span>database;
			<span style="color: #0000ff;">if</span><span style="color: #000000;">&#40;</span>sqlite3_open<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#91;</span>callHisoryDatabasePath UTF8String<span style="color: #000000;">&#93;</span>, <span style="color: #000000;">&amp;</span>database<span style="color: #000000;">&#41;</span> <span style="color: #000000;">==</span> SQLITE_OK<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
				sqlite3_stmt <span style="color: #000000;">*</span>compiledStatement;
				NSString <span style="color: #000000;">*</span>sqlStatement <span style="color: #000000;">=</span> <span style="color: #000000;">&#91;</span>NSString stringWithString<span style="color: #000000;">:</span>@<span style="color: #666666;">&quot;SELECT * FROM call;&quot;</span><span style="color: #000000;">&#93;</span>;
&nbsp;
				<span style="color: #0000ff;">int</span> errorCode <span style="color: #000000;">=</span> sqlite3_prepare_v2<span style="color: #000000;">&#40;</span>database, <span style="color: #000000;">&#91;</span>sqlStatement UTF8String<span style="color: #000000;">&#93;</span>, <span style="color: #000000;">-</span><span style="color: #0000dd;">1</span>, 
												   <span style="color: #000000;">&amp;</span>compiledStatement, <span style="color: #0000ff;">NULL</span><span style="color: #000000;">&#41;</span>;
				<span style="color: #0000ff;">if</span><span style="color: #000000;">&#40;</span> errorCode <span style="color: #000000;">==</span> SQLITE_OK<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
					<span style="color: #0000ff;">int</span> count <span style="color: #000000;">=</span> <span style="color: #0000dd;">1</span>;
&nbsp;
					<span style="color: #0000ff;">while</span><span style="color: #000000;">&#40;</span>sqlite3_step<span style="color: #000000;">&#40;</span>compiledStatement<span style="color: #000000;">&#41;</span> <span style="color: #000000;">==</span> SQLITE_ROW<span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
						<span style="color: #ff0000;">// Read the data from the result row</span>
						NSMutableDictionary <span style="color: #000000;">*</span>callHistoryItem <span style="color: #000000;">=</span> <span style="color: #000000;">&#91;</span><span style="color: #000000;">&#91;</span>NSMutableDictionary alloc<span style="color: #000000;">&#93;</span> init<span style="color: #000000;">&#93;</span>;
						<span style="color: #0000ff;">int</span> numberOfColumns <span style="color: #000000;">=</span> sqlite3_column_count<span style="color: #000000;">&#40;</span>compiledStatement<span style="color: #000000;">&#41;</span>;
						NSString <span style="color: #000000;">*</span>data;
						NSString <span style="color: #000000;">*</span>columnName;
&nbsp;
						<span style="color: #0000ff;">for</span> <span style="color: #000000;">&#40;</span><span style="color: #0000ff;">int</span> i <span style="color: #000000;">=</span> <span style="color: #0000dd;">0</span>; i &lt; numberOfColumns; i<span style="color: #000000;">++</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
							columnName <span style="color: #000000;">=</span> <span style="color: #000000;">&#91;</span><span style="color: #000000;">&#91;</span>NSString alloc<span style="color: #000000;">&#93;</span> initWithUTF8String<span style="color: #000000;">:</span>
										  <span style="color: #000000;">&#40;</span><span style="color: #0000ff;">char</span> <span style="color: #000000;">*</span><span style="color: #000000;">&#41;</span>sqlite3_column_name<span style="color: #000000;">&#40;</span>compiledStatement, i<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#93;</span>;
							data <span style="color: #000000;">=</span> <span style="color: #000000;">&#91;</span><span style="color: #000000;">&#91;</span>NSString alloc<span style="color: #000000;">&#93;</span> initWithUTF8String<span style="color: #000000;">:</span>
									<span style="color: #000000;">&#40;</span><span style="color: #0000ff;">char</span> <span style="color: #000000;">*</span><span style="color: #000000;">&#41;</span>sqlite3_column_text<span style="color: #000000;">&#40;</span>compiledStatement, i<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#93;</span>;
&nbsp;
&nbsp;
							<span style="color: #0000ff;">if</span> <span style="color: #000000;">&#40;</span><span style="color: #000000;">!</span><span style="color: #000000;">&#91;</span>columnName isEqualToString<span style="color: #000000;">:</span>@<span style="color: #666666;">&quot;date&quot;</span><span style="color: #000000;">&#93;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
								<span style="color: #000000;">&#91;</span>callHistoryItem setObject<span style="color: #000000;">:</span>data forKey<span style="color: #000000;">:</span>columnName<span style="color: #000000;">&#93;</span>;
							<span style="color: #000000;">&#125;</span>
							<span style="color: #0000ff;">else</span> <span style="color: #000000;">&#123;</span>
&nbsp;
								NSDateFormatter<span style="color: #000000;">*</span> dateFormatter <span style="color: #000000;">=</span> <span style="color: #000000;">&#91;</span><span style="color: #000000;">&#91;</span>NSDateFormatter alloc<span style="color: #000000;">&#93;</span> init<span style="color: #000000;">&#93;</span>;
								<span style="color: #000000;">&#91;</span>dateFormatter setDateFormat<span style="color: #000000;">:</span>@<span style="color: #666666;">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span style="color: #000000;">&#93;</span>;
								<span style="color: #000000;">&#91;</span>dateFormatter setTimeZone<span style="color: #000000;">:</span><span style="color: #000000;">&#91;</span>NSTimeZone timeZoneWithAbbreviation<span style="color: #000000;">:</span>@<span style="color: #666666;">&quot;H&quot;</span><span style="color: #000000;">&#93;</span><span style="color: #000000;">&#93;</span>;
								NSDate <span style="color: #000000;">*</span>currentDate <span style="color: #000000;">=</span> <span style="color: #000000;">&#91;</span>NSDate dateWithTimeIntervalSince1970<span style="color: #000000;">:</span><span style="color: #000000;">&#91;</span>data intValue<span style="color: #000000;">&#93;</span><span style="color: #000000;">&#93;</span>; 
&nbsp;
								<span style="color: #000000;">&#91;</span>callHistoryItem setObject<span style="color: #000000;">:</span> <span style="color: #000000;">&#91;</span>dateFormatter stringFromDate<span style="color: #000000;">:</span>currentDate<span style="color: #000000;">&#93;</span> forKey<span style="color: #000000;">:</span>columnName<span style="color: #000000;">&#93;</span>;
&nbsp;
							<span style="color: #000000;">&#125;</span>
&nbsp;
&nbsp;
							<span style="color: #0000ff;">if</span> <span style="color: #000000;">&#40;</span><span style="color: #000000;">&#91;</span>columnName isEqualToString<span style="color: #000000;">:</span>@<span style="color: #666666;">&quot;address&quot;</span><span style="color: #000000;">&#93;</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
								<span style="color: #000000;">&#91;</span>callHistoryItem  setObject<span style="color: #000000;">:</span><span style="color: #000000;">&#91;</span>self getPhoneNumberLocation<span style="color: #000000;">:</span>data<span style="color: #000000;">&#93;</span> forKey<span style="color: #000000;">:</span>@<span style="color: #666666;">&quot;area&quot;</span> <span style="color: #000000;">&#93;</span>;
&nbsp;
							<span style="color: #000000;">&#125;</span>
&nbsp;
							<span style="color: #ff0000;">//[callHistoryItem setObject:data forKey:columnName];</span>
&nbsp;
							<span style="color: #000000;">&#91;</span>columnName release<span style="color: #000000;">&#93;</span>;
							<span style="color: #000000;">&#91;</span>data release<span style="color: #000000;">&#93;</span>;
						<span style="color: #000000;">&#125;</span>
						<span style="color: #000000;">&#91;</span>callHistory addObject<span style="color: #000000;">:</span>callHistoryItem<span style="color: #000000;">&#93;</span>;
						<span style="color: #000000;">&#91;</span>callHistoryItem release<span style="color: #000000;">&#93;</span>;
						count<span style="color: #000000;">++</span>;
					<span style="color: #000000;">&#125;</span><span style="color: #ff0000;">//end while</span>
					NSMutableString <span style="color: #000000;">*</span> 	tmp <span style="color: #000000;">=</span> <span style="color: #000000;">&#91;</span><span style="color: #000000;">&#91;</span>NSMutableString alloc<span style="color: #000000;">&#93;</span> initWithString<span style="color: #000000;">:</span>uTextView.<span style="color: #00eeff;">text</span><span style="color: #000000;">&#93;</span>;
					<span style="color: #0000ff;">for</span> <span style="color: #000000;">&#40;</span>NSUInteger i<span style="color: #000000;">=</span><span style="color: #0000dd;">0</span>; i&lt;callHistory.<span style="color: #00eeff;">count</span>; i<span style="color: #000000;">++</span><span style="color: #000000;">&#41;</span> <span style="color: #000000;">&#123;</span>
						<span style="color: #ff0000;">//NSLog(@&quot;%d:%@&quot;,i,[callHistory objectAtIndex:i]);</span>
						NSMutableDictionary <span style="color: #000000;">*</span> data <span style="color: #000000;">=</span> <span style="color: #000000;">&#91;</span>callHistory objectAtIndex<span style="color: #000000;">:</span>i<span style="color: #000000;">&#93;</span>; 
						<span style="color: #000000;">&#91;</span>tmp appendFormat<span style="color: #000000;">:</span>@<span style="color: #666666;">&quot;%d:%@=&gt;%@<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span>,i,<span style="color: #000000;">&#91;</span>data objectForKey<span style="color: #000000;">:</span>@<span style="color: #666666;">&quot;address&quot;</span><span style="color: #000000;">&#93;</span>,<span style="color: #000000;">&#91;</span>data objectForKey<span style="color: #000000;">:</span>@<span style="color: #666666;">&quot;area&quot;</span><span style="color: #000000;">&#93;</span><span style="color: #000000;">&#93;</span>; 
					<span style="color: #000000;">&#125;</span>
&nbsp;
					uTextView.<span style="color: #00eeff;">text</span> <span style="color: #000000;">=</span> tmp;
					<span style="color: #000000;">&#91;</span>tmp release<span style="color: #000000;">&#93;</span>;
&nbsp;
				<span style="color: #000000;">&#125;</span>
				<span style="color: #0000ff;">else</span> <span style="color: #000000;">&#123;</span>
					NSLog<span style="color: #000000;">&#40;</span>@<span style="color: #666666;">&quot;Failed to retrieve table&quot;</span><span style="color: #000000;">&#41;</span>;
					NSLog<span style="color: #000000;">&#40;</span>@<span style="color: #666666;">&quot;Error Code: %d&quot;</span>, errorCode<span style="color: #000000;">&#41;</span>;
				<span style="color: #000000;">&#125;</span>
				sqlite3_finalize<span style="color: #000000;">&#40;</span>compiledStatement<span style="color: #000000;">&#41;</span>;
			<span style="color: #000000;">&#125;</span>
		<span style="color: #000000;">&#125;</span>
&nbsp;
	<span style="color: #000000;">&#125;</span>
&nbsp;
&nbsp;
&nbsp;
<span style="color: #000000;">&#125;</span></pre></div></div>

]]></content:encoded>
			<wfw:commentRss>http://imzc.net/archives/259/feed/</wfw:commentRss>
		<slash:comments>1</slash:comments>
		</item>
		<item>
		<title>使用windows api实现屏幕截图并复制到剪贴板</title>
		<link>http://imzc.net/archives/253/</link>
		<comments>http://imzc.net/archives/253/#comments</comments>
		<pubDate>Mon, 23 Apr 2012 11:10:43 +0000</pubDate>
		<dc:creator>imzc</dc:creator>
				<category><![CDATA[C/C++]]></category>
		<category><![CDATA[Ruby&Testing]]></category>

		<guid isPermaLink="false">http://imzc.net/?p=253</guid>
		<description><![CDATA[最新自动化项目需要使用屏幕截图功能,本来通过autoit发送printscreen键,然后从剪贴板copy出来 [...]]]></description>
			<content:encoded><![CDATA[<p>最新自动化项目需要使用屏幕截图功能,本来通过autoit发送printscreen键,然后从剪贴板copy出来即可.</p>

<div class="wp_syntax"><div class="code"><pre class="ruby" style="font-family:monospace;">    <span style="color:#CC0066; font-weight:bold;">require</span> <span style="color:#996600;">&quot;win32ole&quot;</span>
    t = WIN32OLE.<span style="color:#9900CC;">new</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">&quot;AutoItX3.Control&quot;</span><span style="color:#006600; font-weight:bold;">&#41;</span>
    t.<span style="color:#9900CC;">Send</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">&quot;{PRINTSCREEN}&quot;</span><span style="color:#006600; font-weight:bold;">&#41;</span>   
	<span style="color:#CC0066; font-weight:bold;">sleep</span> <span style="color:#006666;">1</span>
	picture=<span style="color:#6666ff; font-weight:bold;">Win32::Clipboard</span>.<span style="color:#9900CC;">data</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#6666ff; font-weight:bold;">Win32::Clipboard::DIB</span><span style="color:#006600; font-weight:bold;">&#41;</span> 
	<span style="color:#6666ff; font-weight:bold;">ATT::KeyLog</span>.<span style="color:#9900CC;">info</span> <span style="color:#996600;">&quot;pictrue:#{picture.slice(0..10)}&quot;</span> 
	<span style="color:#CC00FF; font-weight:bold;">File</span>.<span style="color:#CC0066; font-weight:bold;">open</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">&quot;xxx.bmp&quot;</span>,<span style="color:#996600;">&quot;wb&quot;</span><span style="color:#006600; font-weight:bold;">&#41;</span><span style="color:#9966CC; font-weight:bold;">do</span> <span style="color:#006600; font-weight:bold;">|</span>f<span style="color:#006600; font-weight:bold;">|</span>
    f.<span style="color:#9900CC;">write</span><span style="color:#006600; font-weight:bold;">&#40;</span>picture<span style="color:#006600; font-weight:bold;">&#41;</span>
	<span style="color:#9966CC; font-weight:bold;">end</span></pre></div></div>

<p>&nbsp;</p>
<p>但是此方法有一定风险,比如在远程桌面连入时,很容易和外部PC的剪贴板混乱.<br />
 因此有了使用原始API截图保存的需求.<br />
使用vs2005创建win32控制台程序,勾选ATL即可.注意工程选项,直接静态编译,使程序能适应各个PC.<br />
下面是源码:<br />
带参数时,保存到对应路径,同时复制到剪贴板.<br />
不带参数时,仅复制到剪贴板.</p>

<div class="wp_syntax"><div class="code"><pre class="cpp" style="font-family:monospace;"><span style="color: #000040;">&amp;</span>nbsp<span style="color: #008080;">;</span>
<span style="color: #666666;">// cap.cpp : 定义控制台应用程序的入口点。</span>
<span style="color: #666666;">//</span>
&nbsp;
<span style="color: #339900;">#include &quot;stdafx.h&quot;  </span>
&nbsp;
<span style="color: #339900;">#include &lt;windows.h&gt;  </span>
<span style="color: #339900;">#include &lt;atlimage.h&gt;  </span>
&nbsp;
&nbsp;
CString GetSuffix<span style="color: #008000;">&#40;</span>CString strFileName<span style="color: #008000;">&#41;</span> 
<span style="color: #008000;">&#123;</span> 
	<span style="color: #0000ff;">return</span> strFileName.<span style="color: #007788;">Right</span><span style="color: #008000;">&#40;</span>strFileName.<span style="color: #007788;">GetLength</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #000040;">-</span>strFileName.<span style="color: #007788;">ReverseFind</span><span style="color: #008000;">&#40;</span><span style="color: #FF0000;">'.'</span><span style="color: #008000;">&#41;</span><span style="color: #000040;">-</span><span style="color: #0000dd;">1</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span> 
<span style="color: #008000;">&#125;</span>
&nbsp;
&nbsp;
<span style="color: #0000ff;">int</span> _tmain<span style="color: #008000;">&#40;</span><span style="color: #0000ff;">int</span> argc, _TCHAR<span style="color: #000040;">*</span> argv<span style="color: #008000;">&#91;</span><span style="color: #008000;">&#93;</span><span style="color: #008000;">&#41;</span>
<span style="color: #008000;">&#123;</span>
&nbsp;
		wprintf<span style="color: #008000;">&#40;</span>_T<span style="color: #008000;">&#40;</span><span style="color: #FF0000;">&quot;Useage:<span style="color: #000099; font-weight: bold;">\n</span><span style="color: #000099; font-weight: bold;">\
</span>1.capture.exe  jpg_path (Save bmp and copy  to clipboard.)<span style="color: #000099; font-weight: bold;">\n</span><span style="color: #000099; font-weight: bold;">\
</span>2.capture.exe (Only copy bmp to your current clipboard.)<span style="color: #000099; font-weight: bold;">\n</span><span style="color: #000099; font-weight: bold;">\
</span>@zc,2012.4.21.&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
&nbsp;
&nbsp;
&nbsp;
&nbsp;
		HWND hwnd <span style="color: #000080;">=</span> <span style="color: #008080;">::</span><span style="color: #007788;">GetDesktopWindow</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>  
		HDC hDC <span style="color: #000080;">=</span> <span style="color: #008080;">::</span><span style="color: #007788;">GetDC</span><span style="color: #008000;">&#40;</span>hwnd<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span> <span style="color: #666666;">//根据窗口来确定截图的大概位置</span>
&nbsp;
		RECT rect<span style="color: #008080;">;</span>  
		<span style="color: #008080;">::</span><span style="color: #007788;">GetClientRect</span><span style="color: #008000;">&#40;</span>hwnd, <span style="color: #000040;">&amp;</span>rect<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>  
		HDC hDCMem <span style="color: #000080;">=</span> <span style="color: #008080;">::</span><span style="color: #007788;">CreateCompatibleDC</span><span style="color: #008000;">&#40;</span>hDC<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>   
&nbsp;
		HBITMAP hBitMap <span style="color: #000080;">=</span> <span style="color: #008080;">::</span><span style="color: #007788;">CreateCompatibleBitmap</span><span style="color: #008000;">&#40;</span>hDC, rect.<span style="color: #007788;">right</span>, rect.<span style="color: #007788;">bottom</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>  
		HBITMAP hOldMap <span style="color: #000080;">=</span> <span style="color: #008000;">&#40;</span>HBITMAP<span style="color: #008000;">&#41;</span><span style="color: #008080;">::</span><span style="color: #007788;">SelectObject</span><span style="color: #008000;">&#40;</span>hDCMem, hBitMap<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>  
&nbsp;
		<span style="color: #008080;">::</span><span style="color: #007788;">BitBlt</span><span style="color: #008000;">&#40;</span>hDCMem, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, rect.<span style="color: #007788;">right</span>, rect.<span style="color: #007788;">bottom</span>, hDC, <span style="color: #0000dd;">0</span>, <span style="color: #0000dd;">0</span>, SRCCOPY<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span> <span style="color: #666666;">//红色部分确定图片的大小位置</span>
&nbsp;
		CImage image<span style="color: #008080;">;</span>  
		image.<span style="color: #007788;">Attach</span><span style="color: #008000;">&#40;</span>hBitMap<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>  
&nbsp;
		<span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>argc<span style="color: #000080;">==</span><span style="color: #0000dd;">2</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#123;</span>
			GUID imageFormat <span style="color: #000080;">=</span> Gdiplus<span style="color: #008080;">::</span><span style="color: #007788;">ImageFormatBMP</span><span style="color: #008080;">;</span>
			CString suffix <span style="color: #000080;">=</span> GetSuffix<span style="color: #008000;">&#40;</span>argv<span style="color: #008000;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #008000;">&#93;</span><span style="color: #008000;">&#41;</span>.<span style="color: #007788;">MakeLower</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>
			<span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>suffix.<span style="color: #007788;">Compare</span><span style="color: #008000;">&#40;</span>_T<span style="color: #008000;">&#40;</span><span style="color: #FF0000;">&quot;jpg&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span><span style="color: #000080;">==</span><span style="color: #0000dd;">0</span><span style="color: #008000;">&#41;</span>
			<span style="color: #008000;">&#123;</span>
				imageFormat<span style="color: #000080;">=</span> Gdiplus<span style="color: #008080;">::</span><span style="color: #007788;">ImageFormatJPEG</span><span style="color: #008080;">;</span> 
				wprintf<span style="color: #008000;">&#40;</span>_T<span style="color: #008000;">&#40;</span><span style="color: #FF0000;">&quot;img type:jpg&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span> 
			<span style="color: #008000;">&#125;</span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>suffix.<span style="color: #007788;">Compare</span><span style="color: #008000;">&#40;</span>_T<span style="color: #008000;">&#40;</span><span style="color: #FF0000;">&quot;png&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span><span style="color: #000080;">==</span><span style="color: #0000dd;">0</span><span style="color: #008000;">&#41;</span>
			<span style="color: #008000;">&#123;</span>
				imageFormat<span style="color: #000080;">=</span> Gdiplus<span style="color: #008080;">::</span><span style="color: #007788;">ImageFormatPNG</span><span style="color: #008080;">;</span>
				wprintf<span style="color: #008000;">&#40;</span>_T<span style="color: #008000;">&#40;</span><span style="color: #FF0000;">&quot;img type:png&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span> 
			<span style="color: #008000;">&#125;</span><span style="color: #0000ff;">else</span>  
			<span style="color: #008000;">&#123;</span>
				imageFormat<span style="color: #000080;">=</span> Gdiplus<span style="color: #008080;">::</span><span style="color: #007788;">ImageFormatBMP</span><span style="color: #008080;">;</span>
				wprintf<span style="color: #008000;">&#40;</span>_T<span style="color: #008000;">&#40;</span><span style="color: #FF0000;">&quot;img type:bmp&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span> 
			<span style="color: #008000;">&#125;</span>
&nbsp;
			image.<span style="color: #007788;">Save</span><span style="color: #008000;">&#40;</span>argv<span style="color: #008000;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #008000;">&#93;</span>,imageFormat<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>  
		<span style="color: #008000;">&#125;</span>
&nbsp;
		<span style="color: #0000ff;">if</span> <span style="color: #008000;">&#40;</span>OpenClipboard<span style="color: #008000;">&#40;</span><span style="color: #0000ff;">NULL</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span> 
		<span style="color: #008000;">&#123;</span> 
			EmptyClipboard<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span> 
			SetClipboardData<span style="color: #008000;">&#40;</span>CF_BITMAP, image<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span> 
			CloseClipboard<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span> 
		<span style="color: #008000;">&#125;</span> 
		<span style="color: #666666;">//::PostMessage(hwnd, WM_KEYDOWN,44 , 0L); //发送 VK_PRINTSCREEN按下的键盘消息   </span>
&nbsp;
		image.<span style="color: #007788;">Detach</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>   
		<span style="color: #008080;">::</span><span style="color: #007788;">SelectObject</span><span style="color: #008000;">&#40;</span>hDCMem, hOldMap<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>  
		<span style="color: #008080;">::</span><span style="color: #007788;">DeleteObject</span><span style="color: #008000;">&#40;</span>hBitMap<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>  
		<span style="color: #008080;">::</span><span style="color: #007788;">DeleteDC</span><span style="color: #008000;">&#40;</span>hDCMem<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>  
		<span style="color: #008080;">::</span><span style="color: #007788;">DeleteDC</span><span style="color: #008000;">&#40;</span>hDC<span style="color: #008000;">&#41;</span><span style="color: #008080;">;</span>  
&nbsp;
	<span style="color: #0000ff;">return</span> <span style="color: #0000dd;">0</span><span style="color: #008080;">;</span>
<span style="color: #008000;">&#125;</span></pre></div></div>

<p>&nbsp;<br />
附件下载:<a href='http://imzc.net/wp-content/uploads/2012/04/cap_src_vs2005.rar'>cap_src_vs2005</a></p>
]]></content:encoded>
			<wfw:commentRss>http://imzc.net/archives/253/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>btstack 蓝牙协议栈</title>
		<link>http://imzc.net/archives/250/</link>
		<comments>http://imzc.net/archives/250/#comments</comments>
		<pubDate>Fri, 13 Apr 2012 15:08:36 +0000</pubDate>
		<dc:creator>imzc</dc:creator>
				<category><![CDATA[IOSDev]]></category>

		<guid isPermaLink="false">http://imzc.net/?p=250</guid>
		<description><![CDATA[btstack 蓝牙协议栈，最近准备开发蓝牙相关的应用，搜索了下，btstack比较不错。 先放上google [...]]]></description>
			<content:encoded><![CDATA[<p>btstack 蓝牙协议栈，最近准备开发蓝牙相关的应用，搜索了下，btstack比较不错。</p>
<p>先放上googlecode官方路径和wiki，研究学习中。。。</p>
<p>http://code.google.com/p/btstack/</p>
<p>http://code.google.com/p/btstack/wiki/GettingStarted</p>
]]></content:encoded>
			<wfw:commentRss>http://imzc.net/archives/250/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>Mac Lion下软件包管理工具</title>
		<link>http://imzc.net/archives/249/</link>
		<comments>http://imzc.net/archives/249/#comments</comments>
		<pubDate>Fri, 13 Apr 2012 14:41:23 +0000</pubDate>
		<dc:creator>imzc</dc:creator>
				<category><![CDATA[IOSDev]]></category>

		<guid isPermaLink="false">http://imzc.net/?p=249</guid>
		<description><![CDATA[Mac Lion虽然已经有appstore了，但是上面基本上找不到linux开源的一些软件，有源码时，也需要本 [...]]]></description>
			<content:encoded><![CDATA[<p>Mac Lion虽然已经有appstore了，但是上面基本上找不到linux开源的一些软件，有源码时，也需要本地编译安装。</p>
<p>为了便于管理，已经有比较好的工具了，推荐如下：</p>
<p>macports :  http://www.macports.org/</p>
<p>homebrew:  http://mxcl.github.com/homebrew/</p>
<p>http://blog.jjgod.org/2009/12/21/homebrew-package-management/</p>
]]></content:encoded>
			<wfw:commentRss>http://imzc.net/archives/249/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>mac装xcode4.3后没有gcc等工具的解决办法</title>
		<link>http://imzc.net/archives/246/</link>
		<comments>http://imzc.net/archives/246/#comments</comments>
		<pubDate>Fri, 13 Apr 2012 14:14:39 +0000</pubDate>
		<dc:creator>imzc</dc:creator>
				<category><![CDATA[IOSDev]]></category>

		<guid isPermaLink="false">http://imzc.net/?p=246</guid>
		<description><![CDATA[最近需要用到gcc，make等工具，一般在安装xcode后就应该有了，但是装了xcode4.3后却没有。 网上 [...]]]></description>
			<content:encoded><![CDATA[<p>最近需要用到gcc，make等工具，一般在安装xcode后就应该有了，但是装了xcode4.3后却没有。</p>
<p>网上搜索了下：</p>
<blockquote><p>Apple announced Xcode 4.3 for OSX Lion and 4.4 for OSX Mountain Lion last week. The major difference is that Xcode no longer provide an installer which is good thing because you now could update Xcode with AppStore in the future, plus it is much easier to carry the development environment with you. However, there is a little problem with this new version of Xcode, is that all command line toolsets and compilers are not visible in terminal.</p></blockquote>
<p>真够悲催的。。。解决的方法：<br />
xcode Preferences &gt; Downloads &gt; Command Line Tools &gt; Install</p>
<p><a href="http://imzc.net/wp-content/uploads/2012/04/command_line_tools.png"><img class="alignnone size-full wp-image-247" title="command_line_tools" src="http://imzc.net/wp-content/uploads/2012/04/command_line_tools.png" alt="" width="932" height="626" /></a></p>
]]></content:encoded>
			<wfw:commentRss>http://imzc.net/archives/246/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>ruby调用OLE实现word输出(支持嵌入图片)</title>
		<link>http://imzc.net/archives/238/</link>
		<comments>http://imzc.net/archives/238/#comments</comments>
		<pubDate>Sun, 01 Apr 2012 09:48:44 +0000</pubDate>
		<dc:creator>imzc</dc:creator>
				<category><![CDATA[Ruby&Testing]]></category>

		<guid isPermaLink="false">http://imzc.net/?p=238</guid>
		<description><![CDATA[由于项目的需要，要实现ruby生成word报告。而且，要求能嵌入图片。 RTF和PDF，ruby都已经有开源的 [...]]]></description>
			<content:encoded><![CDATA[<p>由于项目的需要，要实现ruby生成word报告。而且，要求能嵌入图片。<br />
RTF和PDF，ruby都已经有开源的实现了，但是在github上面找到的都是要求ruby版本在1.8.7之上，<br />
而我们的自动化框架还在1.8.6，所以，都不能使用。<br />
word OLE在哪里去搜索参数列表啊。。。貌似网上都找不到详细的。这个挺悲剧的。<br />
有知道的朋友可以PM我一下，多谢。。。<br />
嵌入图片有两种函数，后来使用了第二种：<br />
ad.Shapes.AddPicture(picture_360.to_s,false,true,left,top,width,height)<br />
sel.InlineShapes.AddPicture(picture_360.to_s,false,true,nil)<br />
经过网上搜索加以整理，最终实现了，代码如下：</p>

<div class="wp_syntax"><div class="code"><pre class="ruby" style="font-family:monospace;"><span style="color:#008000; font-style:italic;"># coding: utf-8</span>
<span style="color:#CC0066; font-weight:bold;">require</span> <span style="color:#996600;">'win32ole'</span>  
&nbsp;
root =  <span style="color:#CC00FF; font-weight:bold;">File</span>.<span style="color:#9900CC;">expand_path</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#CC00FF; font-weight:bold;">File</span>.<span style="color:#9900CC;">dirname</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#0000FF; font-weight:bold;">__FILE__</span><span style="color:#006600; font-weight:bold;">&#41;</span> <span style="color:#006600; font-weight:bold;">&#41;</span>
pic_root = root <span style="color:#006600; font-weight:bold;">+</span> <span style="color:#996600;">&quot;/pics&quot;</span>
start = <span style="color:#CC00FF; font-weight:bold;">Time</span>.<span style="color:#9900CC;">now</span>  
filename = root<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;/virus_scan_reports_&quot;</span><span style="color:#006600; font-weight:bold;">+</span>start.<span style="color:#9900CC;">to_i</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#006600; font-weight:bold;">&#41;</span>.<span style="color:#9900CC;">to_s</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#006600; font-weight:bold;">&#41;</span><span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;.doc&quot;</span> 
&nbsp;
<span style="color:#CC0066; font-weight:bold;">puts</span><span style="color:#006600; font-weight:bold;">&#40;</span>root<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;,time:&quot;</span><span style="color:#006600; font-weight:bold;">+</span>start.<span style="color:#9900CC;">to_i</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#006600; font-weight:bold;">&#41;</span>.<span style="color:#9900CC;">to_s</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#006600; font-weight:bold;">&#41;</span><span style="color:#006600; font-weight:bold;">&#41;</span>
&nbsp;
<span style="color:#9966CC; font-weight:bold;">def</span> word_report<span style="color:#006600; font-weight:bold;">&#40;</span>report_filename,pic_hash,scantitle=<span style="color:#996600;">&quot;&quot;</span><span style="color:#006600; font-weight:bold;">&#41;</span>
word=WIN32OLE.<span style="color:#9900CC;">new</span> <span style="color:#996600;">'word.Application'</span>
word.<span style="color:#9900CC;">visible</span>=<span style="color:#0000FF; font-weight:bold;">false</span> 
doc=word.<span style="color:#9900CC;">Documents</span>
d=doc.<span style="color:#9900CC;">add</span>
sel=word.<span style="color:#9900CC;">Selection</span>
ad=word.<span style="color:#9900CC;">ActiveDocument</span>
&nbsp;
ad.<span style="color:#9900CC;">Styles</span>.<span style="color:#9900CC;">Add</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">'Name'</span><span style="color:#006600; font-weight:bold;">=&gt;</span><span style="color:#996600;">'title'</span><span style="color:#006600; font-weight:bold;">&#41;</span>
font=ad.<span style="color:#9900CC;">Styles</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">&quot;title&quot;</span><span style="color:#006600; font-weight:bold;">&#41;</span>.<span style="color:#9900CC;">Font</span>
font.<span style="color:#9900CC;">Size</span>=<span style="color:#006666;">20</span>
font.<span style="color:#9900CC;">Bold</span>=<span style="color:#0000FF; font-weight:bold;">true</span>
font.<span style="color:#9900CC;">Name</span>=<span style="color:#996600;">&quot;宋体&quot;</span>
&nbsp;
ad.<span style="color:#9900CC;">Styles</span>.<span style="color:#9900CC;">Add</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">'Name'</span><span style="color:#006600; font-weight:bold;">=&gt;</span><span style="color:#996600;">'content'</span><span style="color:#006600; font-weight:bold;">&#41;</span>
font=ad.<span style="color:#9900CC;">Styles</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">&quot;content&quot;</span><span style="color:#006600; font-weight:bold;">&#41;</span>.<span style="color:#9900CC;">Font</span>
font.<span style="color:#9900CC;">Size</span>=<span style="color:#006666;">12</span>
font.<span style="color:#9900CC;">Bold</span>=<span style="color:#0000FF; font-weight:bold;">false</span>
font.<span style="color:#9900CC;">Name</span>=<span style="color:#996600;">&quot;宋体&quot;</span>
&nbsp;
sel.<span style="color:#9900CC;">Style</span>=ad.<span style="color:#9900CC;">Styles</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">&quot;title&quot;</span><span style="color:#006600; font-weight:bold;">&#41;</span>  
sel.<span style="color:#9900CC;">typeText</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">&quot;杀毒报告:#{scantitle}&quot;</span><span style="color:#006600; font-weight:bold;">&#41;</span> 
&nbsp;
sel.<span style="color:#9900CC;">TypeParagraph</span>;
sel.<span style="color:#9900CC;">Style</span>=ad.<span style="color:#9900CC;">Styles</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">&quot;content&quot;</span><span style="color:#006600; font-weight:bold;">&#41;</span> 
&nbsp;
picture_360 = pic_hash<span style="color:#006600; font-weight:bold;">&#91;</span><span style="color:#ff3333; font-weight:bold;">:picture_360</span><span style="color:#006600; font-weight:bold;">&#93;</span>   
picture_macaffee = pic_hash<span style="color:#006600; font-weight:bold;">&#91;</span><span style="color:#ff3333; font-weight:bold;">:picture_macaffee</span><span style="color:#006600; font-weight:bold;">&#93;</span>  
picture_trend = pic_hash<span style="color:#006600; font-weight:bold;">&#91;</span><span style="color:#ff3333; font-weight:bold;">:picture_trend</span><span style="color:#006600; font-weight:bold;">&#93;</span>
picture_duba = pic_hash<span style="color:#006600; font-weight:bold;">&#91;</span><span style="color:#ff3333; font-weight:bold;">:picture_duba</span><span style="color:#006600; font-weight:bold;">&#93;</span> 
picture_rsing = pic_hash<span style="color:#006600; font-weight:bold;">&#91;</span><span style="color:#ff3333; font-weight:bold;">:picture_rsing</span><span style="color:#006600; font-weight:bold;">&#93;</span> 
&nbsp;
sel.<span style="color:#9900CC;">TypeText</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">&quot;360杀毒&quot;</span><span style="color:#006600; font-weight:bold;">&#41;</span>;
sel.<span style="color:#9900CC;">TypeParagraph</span>;
<span style="color:#008000; font-style:italic;">#argvs:$file;msoFalse # link to file ; msoTrue # save with document ;$left, $top, $width, $height</span>
<span style="color:#008000; font-style:italic;">#ad.Shapes.AddPicture(picture_360.to_s,false,true,left,top,width,height)</span>
sel.<span style="color:#9900CC;">InlineShapes</span>.<span style="color:#9900CC;">AddPicture</span><span style="color:#006600; font-weight:bold;">&#40;</span>picture_360.<span style="color:#9900CC;">to_s</span>,<span style="color:#0000FF; font-weight:bold;">false</span>,<span style="color:#0000FF; font-weight:bold;">true</span>,<span style="color:#0000FF; font-weight:bold;">nil</span><span style="color:#006600; font-weight:bold;">&#41;</span>
&nbsp;
sel.<span style="color:#9900CC;">TypeParagraph</span>;
sel.<span style="color:#9900CC;">TypeText</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">&quot;MCaffee杀毒&quot;</span><span style="color:#006600; font-weight:bold;">&#41;</span>;
sel.<span style="color:#9900CC;">TypeParagraph</span>; 
sel.<span style="color:#9900CC;">InlineShapes</span>.<span style="color:#9900CC;">AddPicture</span><span style="color:#006600; font-weight:bold;">&#40;</span>picture_macaffee.<span style="color:#9900CC;">to_s</span>,<span style="color:#0000FF; font-weight:bold;">false</span>,<span style="color:#0000FF; font-weight:bold;">true</span>,<span style="color:#0000FF; font-weight:bold;">nil</span><span style="color:#006600; font-weight:bold;">&#41;</span>
&nbsp;
sel.<span style="color:#9900CC;">TypeParagraph</span>;
sel.<span style="color:#9900CC;">TypeText</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">&quot;Trend Pc-cilin杀毒&quot;</span><span style="color:#006600; font-weight:bold;">&#41;</span>;
sel.<span style="color:#9900CC;">TypeParagraph</span>; 
sel.<span style="color:#9900CC;">InlineShapes</span>.<span style="color:#9900CC;">AddPicture</span><span style="color:#006600; font-weight:bold;">&#40;</span>picture_trend.<span style="color:#9900CC;">to_s</span>,<span style="color:#0000FF; font-weight:bold;">false</span>,<span style="color:#0000FF; font-weight:bold;">true</span>,<span style="color:#0000FF; font-weight:bold;">nil</span><span style="color:#006600; font-weight:bold;">&#41;</span>
&nbsp;
sel.<span style="color:#9900CC;">TypeParagraph</span>;
sel.<span style="color:#9900CC;">TypeText</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">&quot;金山毒霸杀毒&quot;</span><span style="color:#006600; font-weight:bold;">&#41;</span>;
sel.<span style="color:#9900CC;">TypeParagraph</span>; 
sel.<span style="color:#9900CC;">InlineShapes</span>.<span style="color:#9900CC;">AddPicture</span><span style="color:#006600; font-weight:bold;">&#40;</span>picture_duba.<span style="color:#9900CC;">to_s</span>,<span style="color:#0000FF; font-weight:bold;">false</span>,<span style="color:#0000FF; font-weight:bold;">true</span>,<span style="color:#0000FF; font-weight:bold;">nil</span><span style="color:#006600; font-weight:bold;">&#41;</span>
&nbsp;
sel.<span style="color:#9900CC;">TypeParagraph</span>;
sel.<span style="color:#9900CC;">TypeText</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#996600;">&quot;瑞星杀毒&quot;</span><span style="color:#006600; font-weight:bold;">&#41;</span>;
sel.<span style="color:#9900CC;">TypeParagraph</span>; 
sel.<span style="color:#9900CC;">InlineShapes</span>.<span style="color:#9900CC;">AddPicture</span><span style="color:#006600; font-weight:bold;">&#40;</span>picture_rsing.<span style="color:#9900CC;">to_s</span>,<span style="color:#0000FF; font-weight:bold;">false</span>,<span style="color:#0000FF; font-weight:bold;">true</span>,<span style="color:#0000FF; font-weight:bold;">nil</span><span style="color:#006600; font-weight:bold;">&#41;</span>
&nbsp;
<span style="color:#008000; font-style:italic;"># word.ActiveDocument.Save </span>
word.<span style="color:#9900CC;">DefaultSaveFormat</span> 
d.<span style="color:#9900CC;">saveas</span><span style="color:#006600; font-weight:bold;">&#40;</span>report_filename<span style="color:#006600; font-weight:bold;">&#41;</span>;
<span style="color:#008000; font-style:italic;"># word.ActiveDocument.Close</span>
<span style="color:#008000; font-style:italic;"># word.Documents.close() </span>
word.<span style="color:#9900CC;">quit</span><span style="color:#006600; font-weight:bold;">&#40;</span><span style="color:#006600; font-weight:bold;">&#41;</span>    
&nbsp;
<span style="color:#9966CC; font-weight:bold;">end</span>
&nbsp;
&nbsp;
pic_hash = <span style="color:#006600; font-weight:bold;">&#123;</span><span style="color:#006600; font-weight:bold;">&#125;</span>
pic_hash<span style="color:#006600; font-weight:bold;">&#91;</span><span style="color:#ff3333; font-weight:bold;">:picture_360</span><span style="color:#006600; font-weight:bold;">&#93;</span> = pic_root<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;/360_2012_03_31__20_54_27.bmp&quot;</span>      
pic_hash<span style="color:#006600; font-weight:bold;">&#91;</span><span style="color:#ff3333; font-weight:bold;">:picture_macaffee</span><span style="color:#006600; font-weight:bold;">&#93;</span> = pic_root<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;/macaffee_2012_04_01__21_18_36.bmp&quot;</span>  
pic_hash<span style="color:#006600; font-weight:bold;">&#91;</span><span style="color:#ff3333; font-weight:bold;">:picture_trend</span><span style="color:#006600; font-weight:bold;">&#93;</span> = pic_root<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;/trend_pccilin_2012_03_31__20_53_20.bmp&quot;</span>
pic_hash<span style="color:#006600; font-weight:bold;">&#91;</span><span style="color:#ff3333; font-weight:bold;">:picture_duba</span><span style="color:#006600; font-weight:bold;">&#93;</span> = pic_root<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;/kingsoft_duba_2012_03_31__20_55_37.bmp&quot;</span>  
pic_hash<span style="color:#006600; font-weight:bold;">&#91;</span><span style="color:#ff3333; font-weight:bold;">:picture_rsing</span><span style="color:#006600; font-weight:bold;">&#93;</span> = pic_root<span style="color:#006600; font-weight:bold;">+</span><span style="color:#996600;">&quot;/rsing_2012_03_31__20_53_58.bmp&quot;</span>
&nbsp;
word_report<span style="color:#006600; font-weight:bold;">&#40;</span>filename,pic_hash,<span style="color:#996600;">&quot;att test&quot;</span><span style="color:#006600; font-weight:bold;">&#41;</span></pre></div></div>

<p>&nbsp;</p>
]]></content:encoded>
			<wfw:commentRss>http://imzc.net/archives/238/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>autoit3实现命令行调用杀毒软件</title>
		<link>http://imzc.net/archives/234/</link>
		<comments>http://imzc.net/archives/234/#comments</comments>
		<pubDate>Fri, 30 Mar 2012 04:31:53 +0000</pubDate>
		<dc:creator>imzc</dc:creator>
				<category><![CDATA[Ruby&Testing]]></category>

		<guid isPermaLink="false">http://imzc.net/?p=234</guid>
		<description><![CDATA[自动化项目需要调用杀毒软件对特定文件夹进行病毒扫描，但是大部分杀毒软件都没有提供命令行支持。因此只能从图形界面 [...]]]></description>
			<content:encoded><![CDATA[<p>自动化项目需要调用杀毒软件对特定文件夹进行病毒扫描，但是大部分杀毒软件都没有提供命令行支持。因此只能从图形界面操作搞定。<br />
sikuli可以实现截图方式点击，但是不太稳定，而且，对于趋势杀毒软件，只能选择到某个盘符，不能选择到具体的文件夹，故存在一定的弱点。<br />
考虑到杀毒软件都有提供一个右键菜单，查询注册表发现是一个shellext.dll扩展，不能通过rundll32方式调用。因此可以考虑使用autoit进行操作了。重要知识点：<br />
1.使用windows资源管理器打开特定的文件夹，且处于选中状态，explorer支持多种参数，其中select是实现本功能的参数：<br />
RunWait(@ComSpec &amp; &#8216; /c &#8216; &amp; &#8216;explorer /select,&#8217; &amp; $DirName,&#8221;, @SW_HIDE)</p>
<p> 2.有些时候对应的文件夹已经处于打开状态，且可能选中到其他文件夹，因此需要使用autoit3的函数，将所有文件夹取消选中。<br />
 而特定的文件夹再设置为selected。<br />
 3.直接通过_GUICtrlMenu_GetMenu($hWnd)函数总是失败，因此只有采取变通的手段，通过发送windows消息来获取响应的菜单句柄。<br />
 $hMenu = _SendMessage($hWnd, 0x01E1) ;0x01E1 MN_GETHMENU<br />
 4.由于autoit3的GuiMenu.au3还未提供click对应item的功能，因此只能通过发送快捷键： {DOWN}，{ENTER}来实现选择菜单。<br />
 5.右键菜单曾经打算使用发送WM_CONTEXTMENU消息获得，但是发现在某些机子上面又不行，<br />
 ;007B WM_CONTEXTMENU<br />
 ;_WinAPI_PostMessage($hWnd, 0x007B, 0, 0)<br />
 所以只得采取另外的方法：SHIFT+F10，快捷键很爽啊。。。<br />
 6._GUICtrlMenu_GetItemText($hMenu, $iItem[, $fByPos = True])函数有些时候获取不到菜单的名称（可能是程序内部处理了，如360杀毒），因此需要提供通过索引的方式点击。。。<br />
 7.autoit3编译为exe文件，需要选取“console”（默认是GUI的），以便查看程序输出情况。<br />
使用参数： scan &#8220;E:\待扫描文件&#8221; &#8220;使用|扫描|查杀&#8221;<br />
           scan &#8220;E:\待扫描文件&#8221; &#8220;使用|扫描|查杀&#8221;  15 （最后一个参数是在获取不到对应菜单时，直接点击菜单项目序号，排除空白的）<br />
 具体源码见下：</p>

<div class="wp_syntax"><div class="code"><pre class="vbnet" style="font-family:monospace;">#Include &lt;GuiListView.<span style="color: #0000FF;">au3</span>&gt; 
#include &lt;WinAPI.<span style="color: #0000FF;">au3</span>&gt;  
#include &lt;GuiMenu.<span style="color: #0000FF;">au3</span>&gt;
&nbsp;
&nbsp;
&nbsp;
;scan.<span style="color: #0000FF;">exe</span> <span style="color: #808080;">&quot;E:\att_proj\360scan&quot;</span> <span style="color: #808080;">&quot;使用 ESET NOD32 Antivirus 扫描&quot;</span>
&nbsp;
$DirName <span style="color: #008000;">=</span> <span style="color: #808080;">&quot;E:\待扫描文件&quot;</span>
$AntiVirusSoftName <span style="color: #008000;">=</span>  <span style="color: #808080;">&quot;扫描&quot;</span>
&nbsp;
$itemToClick <span style="color: #008000;">=</span> <span style="color: #008000;">-</span><span style="color: #FF0000;">1</span>
&nbsp;
<span style="color: #0600FF;">If</span> <span style="color: #FF0000;">1</span><span style="color: #008000;">=</span><span style="color: #FF0000;">1</span> <span style="color: #FF8000;">Then</span>
&nbsp;
&nbsp;
<span style="color: #0600FF;">If</span> $cmdline<span style="color: #000000;">&#91;</span><span style="color: #FF0000;">0</span><span style="color: #000000;">&#93;</span> <span style="color: #008000;">=</span> <span style="color: #FF0000;">2</span> or $cmdline<span style="color: #000000;">&#91;</span><span style="color: #FF0000;">0</span><span style="color: #000000;">&#93;</span> <span style="color: #008000;">=</span> <span style="color: #FF0000;">3</span> <span style="color: #FF8000;">Then</span>
    $DirName <span style="color: #008000;">=</span> $cmdline<span style="color: #000000;">&#91;</span><span style="color: #FF0000;">1</span><span style="color: #000000;">&#93;</span>
  $AntiVirusSoftName <span style="color: #008000;">=</span> $cmdline<span style="color: #000000;">&#91;</span><span style="color: #FF0000;">2</span><span style="color: #000000;">&#93;</span> 
  <span style="color: #0600FF;">If</span> $cmdline<span style="color: #000000;">&#91;</span><span style="color: #FF0000;">0</span><span style="color: #000000;">&#93;</span> <span style="color: #008000;">=</span> <span style="color: #FF0000;">3</span> <span style="color: #FF8000;">Then</span> $itemToClick <span style="color: #008000;">=</span>  $cmdline<span style="color: #000000;">&#91;</span><span style="color: #FF0000;">3</span><span style="color: #000000;">&#93;</span>
<span style="color: #FF8000;">Else</span>     
  ConsoleWrite<span style="color: #000000;">&#40;</span><span style="color: #008080; font-style: italic;">'Please use this program with two/three argvs, 目录名称 and 右键菜单.'&amp; @CRLF)</span>
  ConsoleWrite<span style="color: #000000;">&#40;</span><span style="color: #008080; font-style: italic;">'Such as programName &quot;D:\appserv&quot; &quot;使用 ESET NOD32 Antivirus 扫描&quot;.' &amp; @CRLF)</span>
  ConsoleWrite<span style="color: #000000;">&#40;</span><span style="color: #008080; font-style: italic;">'Such as programName &quot;D:\appserv&quot; &quot;使用 ESET NOD32 Antivirus 扫描&quot; itermnum(begin at zero) .' &amp; @CRLF)</span>
  <span style="color: #0600FF;">exit</span>
EndIf 
&nbsp;
<span style="color: #0600FF;">If</span> FileExists<span style="color: #000000;">&#40;</span>$DirName<span style="color: #000000;">&#41;</span><span style="color: #008000;">=</span><span style="color: #FF0000;">0</span> <span style="color: #FF8000;">Then</span>
    ConsoleWrite<span style="color: #000000;">&#40;</span><span style="color: #008080; font-style: italic;">'DirName:'&amp;$DirName&amp;' is not exists.' &amp; @CRLF)</span>
  <span style="color: #0600FF;">exit</span>
EndIf
&nbsp;
EndIf
&nbsp;
ConsoleWrite<span style="color: #000000;">&#40;</span><span style="color: #008080; font-style: italic;">'$DirName:'&amp;$DirName&amp;',$AntiVirusSoftName:'&amp;$AntiVirusSoftName &amp; @CRLF)</span>
&nbsp;
$array <span style="color: #008000;">=</span> StringSplit<span style="color: #000000;">&#40;</span>$DirName, <span style="color: #008080; font-style: italic;">'\', 1)</span>
$ItemName <span style="color: #008000;">=</span> $array<span style="color: #000000;">&#91;</span><span style="color: #0600FF;">UBound</span><span style="color: #000000;">&#40;</span>$array<span style="color: #000000;">&#41;</span><span style="color: #008000;">-</span><span style="color: #FF0000;">1</span><span style="color: #000000;">&#93;</span>
ConsoleWrite<span style="color: #000000;">&#40;</span><span style="color: #008080; font-style: italic;">'$ItemName:'&amp;$ItemName&amp; @CRLF)</span>
&nbsp;
;close all window
&nbsp;
&nbsp;
&nbsp;
&nbsp;
&nbsp;
;While <span style="color: #FF0000;">1</span> ;use infinite <span style="color: #0600FF;">loop</span> since ExitLoop will <span style="color: #FF8000;">get</span> called
;   $TITLE <span style="color: #008000;">=</span> WinGetTitle<span style="color: #000000;">&#40;</span><span style="color: #808080;">&quot;[CLASS:CabinetWClass]&quot;</span>,<span style="color: #808080;">&quot;&quot;</span><span style="color: #000000;">&#41;</span>
;  ConsoleWrite<span style="color: #000000;">&#40;</span><span style="color: #808080;">&quot;Try to Close one control: [CLASS:CabinetWClass],title:&quot;</span><span style="color: #008000;">&amp;</span>$TITLE<span style="color: #008000;">&amp;</span> @<span style="color: #0600FF;">CRLF</span><span style="color: #000000;">&#41;</span>
;  $hanlde <span style="color: #008000;">=</span> WinGetHandle<span style="color: #000000;">&#40;</span>$TITLE<span style="color: #000000;">&#41;</span> 
 ;   $ans <span style="color: #008000;">=</span> WinClose<span style="color: #000000;">&#40;</span>$hanlde<span style="color: #000000;">&#41;</span>  
 ;   <span style="color: #0600FF;">If</span> $ans <span style="color: #008000;">=</span> <span style="color: #FF0000;">0</span> <span style="color: #FF8000;">Then</span> ExitLoop
;WEnd 
&nbsp;
RunWait<span style="color: #000000;">&#40;</span>@ComSpec <span style="color: #008000;">&amp;</span> <span style="color: #008080; font-style: italic;">' /c ' &amp; 'explorer /select,' &amp; $DirName,'', @SW_HIDE)</span>
&nbsp;
Opt<span style="color: #000000;">&#40;</span><span style="color: #808080;">&quot;WinTitleMatchMode&quot;</span>, <span style="color: #FF0000;">1</span><span style="color: #000000;">&#41;</span>     ;<span style="color: #FF0000;">1</span><span style="color: #008000;">=</span>start, <span style="color: #FF0000;">2</span><span style="color: #008000;">=</span>subStr, <span style="color: #FF0000;">3</span><span style="color: #008000;">=</span>exact, <span style="color: #FF0000;">4</span><span style="color: #008000;">=</span>advanced, <span style="color: #008000;">-</span><span style="color: #FF0000;">1</span> <span style="color: #FF8000;">to</span> <span style="color: #008000;">-</span><span style="color: #FF0000;">4</span><span style="color: #008000;">=</span>Nocase
&nbsp;
WinSetState<span style="color: #000000;">&#40;</span><span style="color: #808080;">&quot;[CLASS:CabinetWClass]&quot;</span>, <span style="color: #808080;">&quot;&quot;</span>, @SW_SHOW<span style="color: #000000;">&#41;</span>
;WinActivate<span style="color: #000000;">&#40;</span><span style="color: #808080;">&quot;[CLASS:CabinetWClass]&quot;</span>, <span style="color: #808080;">&quot;&quot;</span><span style="color: #000000;">&#41;</span>
&nbsp;
;$hWnd <span style="color: #008000;">=</span> ControlGetHandle<span style="color: #000000;">&#40;</span><span style="color: #808080;">&quot;&quot;</span>,<span style="color: #808080;">&quot;FolderView&quot;</span>,<span style="color: #808080;">&quot;[CLASS:SysListView32]&quot;</span><span style="color: #000000;">&#41;</span>
$hWnd <span style="color: #008000;">=</span> ControlGetHandle<span style="color: #000000;">&#40;</span><span style="color: #808080;">&quot;&quot;</span>,<span style="color: #808080;">&quot;FolderView&quot;</span>,<span style="color: #808080;">&quot;[CLASS:SysListView32; INSTANCE:1]&quot;</span><span style="color: #000000;">&#41;</span>
&nbsp;
;$pos <span style="color: #008000;">=</span> ControlGetPos<span style="color: #000000;">&#40;</span><span style="color: #808080;">&quot;&quot;</span>,<span style="color: #808080;">&quot;FolderView&quot;</span>,<span style="color: #808080;">&quot;[CLASS:SysListView32]&quot;</span><span style="color: #000000;">&#41;</span>
;MsgBox<span style="color: #000000;">&#40;</span><span style="color: #FF0000;">0</span>, <span style="color: #808080;">&quot;Window Stats:&quot;</span>, <span style="color: #808080;">&quot;POS: &quot;</span> <span style="color: #008000;">&amp;</span> $pos<span style="color: #000000;">&#91;</span><span style="color: #FF0000;">0</span><span style="color: #000000;">&#93;</span> <span style="color: #008000;">&amp;</span> <span style="color: #808080;">&quot;,&quot;</span> <span style="color: #008000;">&amp;</span> $pos<span style="color: #000000;">&#91;</span><span style="color: #FF0000;">1</span><span style="color: #000000;">&#93;</span> <span style="color: #008000;">&amp;</span> <span style="color: #808080;">&quot; SIZE: &quot;</span> <span style="color: #008000;">&amp;</span> $pos<span style="color: #000000;">&#91;</span><span style="color: #FF0000;">2</span><span style="color: #000000;">&#93;</span> <span style="color: #008000;">&amp;</span> <span style="color: #808080;">&quot;,&quot;</span> <span style="color: #008000;">&amp;</span> $pos<span style="color: #000000;">&#91;</span><span style="color: #FF0000;">3</span><span style="color: #000000;">&#93;</span> <span style="color: #000000;">&#41;</span>
&nbsp;
&nbsp;
&nbsp;
$items  <span style="color: #008000;">=</span> _GUICtrlListView_GetItemCount<span style="color: #000000;">&#40;</span>$hWnd<span style="color: #000000;">&#41;</span>
&nbsp;
&nbsp;
;ConsoleWrite<span style="color: #000000;">&#40;</span><span style="color: #808080;">&quot;Item Count: &quot;</span> <span style="color: #008000;">&amp;</span> $items <span style="color: #008000;">&amp;</span> @<span style="color: #0600FF;">CRLF</span><span style="color: #000000;">&#41;</span>
&nbsp;
;ConsoleWrite<span style="color: #000000;">&#40;</span><span style="color: #808080;">&quot;Item  Focused: &quot;</span> <span style="color: #008000;">&amp;</span> _GUICtrlListView_GetItemFocused<span style="color: #000000;">&#40;</span>$hWnd, <span style="color: #FF0000;">1</span><span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>
&nbsp;
&nbsp;
<span style="color: #FF8000;">For</span> $i <span style="color: #008000;">=</span> <span style="color: #FF0000;">0</span> <span style="color: #FF8000;">To</span> $items <span style="color: #008000;">-</span><span style="color: #FF0000;">1</span>
 $ItemText <span style="color: #008000;">=</span> _GUICtrlListView_GetItemText<span style="color: #000000;">&#40;</span>$hWnd, $i<span style="color: #000000;">&#41;</span>
 ;ConsoleWrite<span style="color: #000000;">&#40;</span>$ItemText<span style="color: #008000;">&amp;</span> @<span style="color: #0600FF;">CRLF</span><span style="color: #000000;">&#41;</span>
 _GUICtrlListView_SetItemSelected<span style="color: #000000;">&#40;</span>$hWnd,$i,<span style="color: #0600FF;">False</span><span style="color: #000000;">&#41;</span>
 Sleep<span style="color: #000000;">&#40;</span><span style="color: #FF0000;">10</span><span style="color: #000000;">&#41;</span>
 <span style="color: #0600FF;">If</span> $ItemText <span style="color: #008000;">=</span> $ItemName <span style="color: #FF8000;">Then</span>
  $aRect <span style="color: #008000;">=</span> _GUICtrlListView_GetItemRect<span style="color: #000000;">&#40;</span>$hWnd,$i<span style="color: #000000;">&#41;</span>
  ConsoleWrite<span style="color: #000000;">&#40;</span>StringFormat<span style="color: #000000;">&#40;</span><span style="color: #808080;">&quot;Item 2 Rectangle : [%d, %d, %d, %d]&quot;</span>, $aRect<span style="color: #000000;">&#91;</span><span style="color: #FF0000;">0</span><span style="color: #000000;">&#93;</span>, $aRect<span style="color: #000000;">&#91;</span><span style="color: #FF0000;">1</span><span style="color: #000000;">&#93;</span>, $aRect<span style="color: #000000;">&#91;</span><span style="color: #FF0000;">2</span><span style="color: #000000;">&#93;</span>, $aRect<span style="color: #000000;">&#91;</span><span style="color: #FF0000;">3</span><span style="color: #000000;">&#93;</span><span style="color: #000000;">&#41;</span><span style="color: #008000;">&amp;</span> @<span style="color: #0600FF;">CRLF</span><span style="color: #000000;">&#41;</span>
&nbsp;
  $aPos <span style="color: #008000;">=</span> _GUICtrlListView_GetItemPosition<span style="color: #000000;">&#40;</span>$hWnd, $i<span style="color: #000000;">&#41;</span>
  ConsoleWrite<span style="color: #000000;">&#40;</span>StringFormat<span style="color: #000000;">&#40;</span><span style="color: #808080;">&quot;Item Position : [%d, %d]&quot;</span>, $aPos<span style="color: #000000;">&#91;</span><span style="color: #FF0000;">0</span><span style="color: #000000;">&#93;</span>, $aPos<span style="color: #000000;">&#91;</span><span style="color: #FF0000;">1</span><span style="color: #000000;">&#93;</span><span style="color: #000000;">&#41;</span><span style="color: #008000;">&amp;</span> @<span style="color: #0600FF;">CRLF</span><span style="color: #000000;">&#41;</span>
&nbsp;
  ;MouseMove <span style="color: #000000;">&#40;</span>$aRect<span style="color: #000000;">&#91;</span><span style="color: #FF0000;">2</span><span style="color: #000000;">&#93;</span>, $aRect<span style="color: #000000;">&#91;</span><span style="color: #FF0000;">3</span><span style="color: #000000;">&#93;</span><span style="color: #000000;">&#41;</span>
  ;Sleep<span style="color: #000000;">&#40;</span><span style="color: #FF0000;">2000</span><span style="color: #000000;">&#41;</span>
  ;ControlClick<span style="color: #000000;">&#40;</span><span style="color: #808080;">&quot;&quot;</span>,<span style="color: #808080;">&quot;FolderView&quot;</span>,<span style="color: #808080;">&quot;[CLASS:SysListView32]&quot;</span>,<span style="color: #808080;">&quot;right&quot;</span>,<span style="color: #FF0000;">1</span>,$aPos<span style="color: #000000;">&#91;</span><span style="color: #FF0000;">0</span><span style="color: #000000;">&#93;</span><span style="color: #008000;">+</span><span style="color: #FF0000;">20</span>,$aPos<span style="color: #000000;">&#91;</span><span style="color: #FF0000;">1</span><span style="color: #000000;">&#93;</span><span style="color: #008000;">+</span><span style="color: #FF0000;">20</span><span style="color: #000000;">&#41;</span>
&nbsp;
    $centerX <span style="color: #008000;">=</span> <span style="color: #000000;">&#40;</span>$aRect<span style="color: #000000;">&#91;</span><span style="color: #FF0000;">0</span><span style="color: #000000;">&#93;</span> <span style="color: #008000;">+</span> $aRect<span style="color: #000000;">&#91;</span><span style="color: #FF0000;">2</span><span style="color: #000000;">&#93;</span><span style="color: #000000;">&#41;</span><span style="color: #008000;">/</span><span style="color: #FF0000;">2</span>
  $centerY <span style="color: #008000;">=</span> <span style="color: #000000;">&#40;</span>$aRect<span style="color: #000000;">&#91;</span><span style="color: #FF0000;">1</span><span style="color: #000000;">&#93;</span> <span style="color: #008000;">+</span> $aRect<span style="color: #000000;">&#91;</span><span style="color: #FF0000;">3</span><span style="color: #000000;">&#93;</span><span style="color: #000000;">&#41;</span><span style="color: #008000;">/</span><span style="color: #FF0000;">2</span>
  $aPos <span style="color: #008000;">=</span> _GUICtrlListView_GetItemPosition<span style="color: #000000;">&#40;</span>$hWnd, $i<span style="color: #000000;">&#41;</span>
  ConsoleWrite<span style="color: #000000;">&#40;</span>StringFormat<span style="color: #000000;">&#40;</span><span style="color: #808080;">&quot;Item Position : [%d, %d]&quot;</span>, $aPos<span style="color: #000000;">&#91;</span><span style="color: #FF0000;">0</span><span style="color: #000000;">&#93;</span>, $aPos<span style="color: #000000;">&#91;</span><span style="color: #FF0000;">1</span><span style="color: #000000;">&#93;</span><span style="color: #000000;">&#41;</span><span style="color: #008000;">&amp;</span> @<span style="color: #0600FF;">CRLF</span><span style="color: #000000;">&#41;</span>
&nbsp;
  _GUICtrlListView_SetItemSelected<span style="color: #000000;">&#40;</span>$hWnd,$i<span style="color: #000000;">&#41;</span>
&nbsp;
  ;MouseMove <span style="color: #000000;">&#40;</span>$aRect<span style="color: #000000;">&#91;</span><span style="color: #FF0000;">2</span><span style="color: #000000;">&#93;</span>, $aRect<span style="color: #000000;">&#91;</span><span style="color: #FF0000;">3</span><span style="color: #000000;">&#93;</span><span style="color: #000000;">&#41;</span>
  ;Sleep<span style="color: #000000;">&#40;</span><span style="color: #FF0000;">2000</span><span style="color: #000000;">&#41;</span>
  ;ControlClick<span style="color: #000000;">&#40;</span><span style="color: #808080;">&quot;&quot;</span>,<span style="color: #808080;">&quot;FolderView&quot;</span>,<span style="color: #808080;">&quot;[CLASS:SysListView32]&quot;</span>,<span style="color: #808080;">&quot;right&quot;</span>,<span style="color: #FF0000;">1</span>,$centerX,$centerY<span style="color: #000000;">&#41;</span>
&nbsp;
  ;ExitLoop 
 EndIf
&nbsp;
<span style="color: #FF8000;">Next</span>
&nbsp;
&nbsp;
&nbsp;
;MsgBox<span style="color: #000000;">&#40;</span><span style="color: #FF0000;">0</span>, <span style="color: #808080;">&quot;HWnd:t,c&quot;</span>, $hWndf <span style="color: #008000;">&amp;</span><span style="color: #808080;">&quot;,&quot;</span><span style="color: #008000;">&amp;</span>$hWnd<span style="color: #000000;">&#41;</span>
;007B WM_CONTEXTMENU
;0x001611DA
;_WinAPI_PostMessage<span style="color: #000000;">&#40;</span>$hWnd, 0x007B, 0x001611da,0x00d30342<span style="color: #000000;">&#41;</span>
&nbsp;
;_WinAPI_PostMessage<span style="color: #000000;">&#40;</span>$hWnd, 0x007B, <span style="color: #FF0000;">0</span>, <span style="color: #FF0000;">0</span><span style="color: #000000;">&#41;</span>;<span style="color: #FF0000;">100</span>,<span style="color: #FF0000;">100</span><span style="color: #000000;">&#41;</span>
&nbsp;
Opt<span style="color: #000000;">&#40;</span><span style="color: #008080; font-style: italic;">'WinSearchChildren', 1)</span>
&nbsp;
HotKeySet<span style="color: #000000;">&#40;</span><span style="color: #008080; font-style: italic;">'{ESC}', '_EXIT')</span>
OnAutoItExitRegister<span style="color: #000000;">&#40;</span><span style="color: #008080; font-style: italic;">'OnAutoItExit')</span>
&nbsp;
Global <span style="color: #0600FF;">Const</span> $MN_GETHMENU <span style="color: #008000;">=</span> 0x01E1
Global <span style="color: #0600FF;">Const</span> $EVENT_SYSTEM_MENUPOPUPSTART <span style="color: #008000;">=</span> 0x0006
Global <span style="color: #0600FF;">Const</span> $EVENT_SYSTEM_MENUPOPUPEND <span style="color: #008000;">=</span> 0x0007  
Global $hFunc, $pFunc
Global $hWinHook
&nbsp;
$hFunc <span style="color: #008000;">=</span> DllCallbackRegister<span style="color: #000000;">&#40;</span><span style="color: #008080; font-style: italic;">'_WinEventProc', 'none', 'ptr;uint;hwnd;int;int;uint;uint')</span>
$pFunc <span style="color: #008000;">=</span> DllCallbackGetPtr<span style="color: #000000;">&#40;</span>$hFunc<span style="color: #000000;">&#41;</span>
$hWinHook <span style="color: #008000;">=</span> _SetWinEventHook<span style="color: #000000;">&#40;</span>0x00000001, 0x7FFFFFFF, <span style="color: #FF0000;">0</span>, $pFunc, <span style="color: #FF0000;">0</span>, <span style="color: #FF0000;">0</span>,<span style="color: #804040;">BitOR</span><span style="color: #000000;">&#40;</span>0x0002, 0x0000<span style="color: #000000;">&#41;</span><span style="color: #000000;">&#41;</span>
&nbsp;
&nbsp;
 Send<span style="color: #000000;">&#40;</span><span style="color: #808080;">&quot;+{F10}&quot;</span><span style="color: #000000;">&#41;</span> ;弹出右键菜单
&nbsp;
&nbsp;
&nbsp;
<span style="color: #0600FF;">While</span> <span style="color: #FF0000;">1</span>
        Sleep<span style="color: #000000;">&#40;</span><span style="color: #FF0000;">20</span><span style="color: #000000;">&#41;</span>
<span style="color: #0600FF;">WEnd</span>
&nbsp;
<span style="color: #FF8000;">Func</span> _EXIT<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>
        <span style="color: #0600FF;">Exit</span>
EndFunc   ;<span style="color: #008000;">==</span>&gt;_EXIT
&nbsp;
<span style="color: #FF8000;">Func</span> OnAutoItExit<span style="color: #000000;">&#40;</span><span style="color: #000000;">&#41;</span>
        _UnhookWinEvent<span style="color: #000000;">&#40;</span>$hWinHook<span style="color: #000000;">&#41;</span>
        DllCallbackFree<span style="color: #000000;">&#40;</span>$hFunc<span style="color: #000000;">&#41;</span>
EndFunc   ;<span style="color: #008000;">==</span>&gt;OnAutoItExit
&nbsp;
<span style="color: #FF8000;">Func</span> _WinEventProc<span style="color: #000000;">&#40;</span>$hHook, $iEvent, $hWnd, $iObjectID, $iChildID, $iEventThread, $imsEventTime<span style="color: #000000;">&#41;</span>
        Local $hMenu
&nbsp;
      <span style="color: #0600FF;">If</span> $iEvent <span style="color: #008000;">=</span> $EVENT_SYSTEM_MENUPOPUPSTART  <span style="color: #FF8000;">Then</span>
                $hMenu <span style="color: #008000;">=</span> _SendMessage<span style="color: #000000;">&#40;</span>$hWnd, 0x01E1<span style="color: #000000;">&#41;</span> ;0x01E1 MN_GETHMENU 
                <span style="color: #0600FF;">If</span> _GUICtrlMenu_IsMenu<span style="color: #000000;">&#40;</span>$hMenu<span style="color: #000000;">&#41;</span> <span style="color: #FF8000;">Then</span>
&nbsp;
            <span style="color: #0600FF;">If</span> $itemToClick &lt;&gt; <span style="color: #008000;">-</span><span style="color: #FF0000;">1</span> <span style="color: #FF8000;">Then</span>
&nbsp;
              ConsoleWrite<span style="color: #000000;">&#40;</span><span style="color: #808080;">&quot;Click menu item direct.&quot;</span><span style="color: #008000;">&amp;</span> @<span style="color: #0600FF;">CRLF</span><span style="color: #000000;">&#41;</span>; 
               <span style="color: #FF8000;">For</span> $i <span style="color: #008000;">=</span> <span style="color: #FF0000;">0</span> <span style="color: #FF8000;">To</span> _GUICtrlMenu_GetItemCount<span style="color: #000000;">&#40;</span>$hMenu<span style="color: #000000;">&#41;</span> <span style="color: #008000;">-</span> <span style="color: #FF0000;">1</span>
                Send <span style="color: #000000;">&#40;</span><span style="color: #808080;">&quot;{DOWN}&quot;</span><span style="color: #000000;">&#41;</span> 
                <span style="color: #0600FF;">If</span> $itemToClick <span style="color: #008000;">=</span> $i <span style="color: #FF8000;">Then</span>
                  ConsoleWrite<span style="color: #000000;">&#40;</span><span style="color: #808080;">&quot;Click menu item :&quot;</span> <span style="color: #008000;">&amp;</span>$itemToClick<span style="color: #008000;">&amp;</span> @<span style="color: #0600FF;">CRLF</span><span style="color: #000000;">&#41;</span>;  
                  Sleep<span style="color: #000000;">&#40;</span><span style="color: #FF0000;">1000</span><span style="color: #000000;">&#41;</span>
                  Send <span style="color: #000000;">&#40;</span><span style="color: #808080;">&quot;{ENTER}&quot;</span><span style="color: #000000;">&#41;</span> 
                  ExitLoop
                  EndIf
&nbsp;
              <span style="color: #FF8000;">Next</span> 
              <span style="color: #0600FF;">Exit</span><span style="color: #000000;">&#40;</span><span style="color: #FF0000;">0</span><span style="color: #000000;">&#41;</span>
            <span style="color: #FF8000;">Else</span> 
              $i<span style="color: #008000;">=</span><span style="color: #FF0000;">0</span>
              <span style="color: #FF8000;">For</span> $i <span style="color: #008000;">=</span> <span style="color: #FF0000;">0</span> <span style="color: #FF8000;">To</span> _GUICtrlMenu_GetItemCount<span style="color: #000000;">&#40;</span>$hMenu<span style="color: #000000;">&#41;</span> <span style="color: #008000;">-</span> <span style="color: #FF0000;">1</span>
&nbsp;
                  Sleep<span style="color: #000000;">&#40;</span><span style="color: #FF0000;">10</span><span style="color: #000000;">&#41;</span>  
                  Local $sItemText <span style="color: #008000;">=</span> _GUICtrlMenu_GetItemText<span style="color: #000000;">&#40;</span>$hMenu, $i<span style="color: #000000;">&#41;</span>
&nbsp;
                  ConsoleWrite<span style="color: #000000;">&#40;</span>$sItemText<span style="color: #008000;">&amp;</span><span style="color: #808080;">&quot;,item index:&quot;</span><span style="color: #008000;">&amp;</span>$i <span style="color: #008000;">&amp;</span> @<span style="color: #0600FF;">CRLF</span><span style="color: #000000;">&#41;</span>; 
&nbsp;
                  <span style="color: #0600FF;">If</span> $sItemText <span style="color: #008000;">=</span> <span style="color: #008080; font-style: italic;">'' Then ContinueLoop    </span>
&nbsp;
                  Send <span style="color: #000000;">&#40;</span><span style="color: #808080;">&quot;{DOWN}&quot;</span><span style="color: #000000;">&#41;</span>
                  ;If StringInStr<span style="color: #000000;">&#40;</span>$sItemText,$AntiVirusSoftName<span style="color: #000000;">&#41;</span> &lt;&gt; <span style="color: #FF0000;">0</span> <span style="color: #FF8000;">Then</span>
                  <span style="color: #0600FF;">If</span> StringRegExp <span style="color: #000000;">&#40;</span>$sItemText,$AntiVirusSoftName,<span style="color: #FF0000;">0</span><span style="color: #000000;">&#41;</span> <span style="color: #008000;">=</span><span style="color: #FF0000;">1</span> <span style="color: #FF8000;">Then</span>
                    ConsoleWrite<span style="color: #000000;">&#40;</span><span style="color: #808080;">&quot;StringRegExp match,item index:&quot;</span><span style="color: #008000;">&amp;</span>$i <span style="color: #008000;">&amp;</span> @<span style="color: #0600FF;">CRLF</span><span style="color: #000000;">&#41;</span>; 
                    ;MsgBox<span style="color: #000000;">&#40;</span><span style="color: #FF0000;">0</span>, <span style="color: #808080;">&quot;HWnd&quot;</span>, <span style="color: #808080;">&quot;nod32&quot;</span><span style="color: #000000;">&#41;</span>
                    ;$subviewid <span style="color: #008000;">=</span> _GUICtrlMenu_GetItemID<span style="color: #000000;">&#40;</span>$hMenu, $i<span style="color: #000000;">&#41;</span>
                    ;_GUICtrlMenu_SetItemState<span style="color: #000000;">&#40;</span>$hMenu, $i, $MFS_CHECKED,<span style="color: #0600FF;">True</span><span style="color: #000000;">&#41;</span>
                    ;_GUICtrlMenu_SetItemDisabled<span style="color: #000000;">&#40;</span>$hMenu, $i<span style="color: #000000;">&#41;</span>
                    ;Send <span style="color: #000000;">&#40;</span><span style="color: #808080;">&quot;{ENTER}&quot;</span><span style="color: #000000;">&#41;</span> 
                    Sleep<span style="color: #000000;">&#40;</span><span style="color: #FF0000;">1000</span><span style="color: #000000;">&#41;</span>
                    Send <span style="color: #000000;">&#40;</span><span style="color: #808080;">&quot;{ENTER}&quot;</span><span style="color: #000000;">&#41;</span>
                    ;ControlClick<span style="color: #000000;">&#40;</span><span style="color: #808080;">&quot;&quot;</span>, <span style="color: #808080;">&quot;&quot;</span>,$subviewid ,<span style="color: #808080;">&quot;left&quot;</span><span style="color: #000000;">&#41;</span> 
                    ExitLoop
                  EndIf
&nbsp;
              <span style="color: #FF8000;">Next</span> 
               <span style="color: #0600FF;">If</span> $i <span style="color: #008000;">=</span> <span style="color: #000000;">&#40;</span>_GUICtrlMenu_GetItemCount<span style="color: #000000;">&#40;</span>$hMenu<span style="color: #000000;">&#41;</span> <span style="color: #008000;">-</span> <span style="color: #FF0000;">1</span><span style="color: #000000;">&#41;</span> <span style="color: #FF8000;">Then</span> ConsoleWrite<span style="color: #000000;">&#40;</span><span style="color: #808080;">&quot;Not found,then click the first null menu.&quot;</span> <span style="color: #008000;">&amp;</span> @<span style="color: #0600FF;">CRLF</span><span style="color: #000000;">&#41;</span> 
            EndIf
          <span style="color: #0600FF;">Exit</span><span style="color: #000000;">&#40;</span><span style="color: #FF0000;">0</span><span style="color: #000000;">&#41;</span>
          EndIf
&nbsp;
                ConsoleWrite<span style="color: #000000;">&#40;</span><span style="color: #808080;">&quot;Not Menu hwnd.&quot;</span>@<span style="color: #0600FF;">CRLF</span><span style="color: #000000;">&#41;</span>
      EndIf
&nbsp;
&nbsp;
&nbsp;
&nbsp;
EndFunc   ;<span style="color: #008000;">==</span>&gt;_WinEventProc
&nbsp;
<span style="color: #FF8000;">Func</span> _SetWinEventHook<span style="color: #000000;">&#40;</span>$ieventMin, $ieventMax, $hMod, $pCallback, $iProcID, $iThreadID, $iFlags<span style="color: #000000;">&#41;</span>
        Local $aRet
&nbsp;
        $aRet <span style="color: #008000;">=</span> DllCall<span style="color: #000000;">&#40;</span><span style="color: #008080; font-style: italic;">'user32.dll', 'ptr', 'SetWinEventHook', 'uint', $ieventMin, 'uint', $ieventMax, _</span>
                        <span style="color: #008080; font-style: italic;">'hwnd', $hMod, 'ptr', $pCallback, 'dword', $iProcID, 'dword', $iThreadID, 'uint', $iFlags)</span>
&nbsp;
        <span style="color: #0600FF;">If</span> @<span style="color: #FF8000;">error</span> Or $aRet<span style="color: #000000;">&#91;</span><span style="color: #FF0000;">0</span><span style="color: #000000;">&#93;</span> <span style="color: #008000;">=</span> <span style="color: #FF0000;">0</span> <span style="color: #FF8000;">Then</span> <span style="color: #FF8000;">Return</span> SetError<span style="color: #000000;">&#40;</span><span style="color: #FF0000;">1</span>, <span style="color: #FF0000;">0</span>, <span style="color: #FF0000;">0</span><span style="color: #000000;">&#41;</span>
        <span style="color: #FF8000;">Return</span> $aRet<span style="color: #000000;">&#91;</span><span style="color: #FF0000;">0</span><span style="color: #000000;">&#93;</span>
EndFunc   ;<span style="color: #008000;">==</span>&gt;_SetWinEventHook
&nbsp;
<span style="color: #FF8000;">Func</span> _UnhookWinEvent<span style="color: #000000;">&#40;</span>$hWinEventHook<span style="color: #000000;">&#41;</span>
        Local $aRet
&nbsp;
        $aRet <span style="color: #008000;">=</span> DllCall<span style="color: #000000;">&#40;</span><span style="color: #008080; font-style: italic;">'user32.dll', 'int', 'UnhookWinEvent', 'ptr', $hWinEventHook)</span>
        <span style="color: #0600FF;">If</span> @<span style="color: #FF8000;">error</span> Or $aRet<span style="color: #000000;">&#91;</span><span style="color: #FF0000;">0</span><span style="color: #000000;">&#93;</span> <span style="color: #008000;">=</span> <span style="color: #FF0000;">0</span> <span style="color: #FF8000;">Then</span> <span style="color: #FF8000;">Return</span> SetError<span style="color: #000000;">&#40;</span><span style="color: #FF0000;">1</span>, <span style="color: #FF0000;">0</span>, <span style="color: #FF0000;">0</span><span style="color: #000000;">&#41;</span>
        <span style="color: #FF8000;">Return</span> $aRet<span style="color: #000000;">&#91;</span><span style="color: #FF0000;">0</span><span style="color: #000000;">&#93;</span>
EndFunc   ;<span style="color: #008000;">==</span>&gt;_UnhookWinEvent</pre></div></div>

<p>附件下载：<a href='http://imzc.net/wp-content/uploads/2012/03/scan_menu.rar'>scan_menu</a></p>
]]></content:encoded>
			<wfw:commentRss>http://imzc.net/archives/234/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
	</channel>
</rss>
